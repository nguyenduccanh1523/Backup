{
  "name": "AI Agent Facebook Messager",
  "nodes": [
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "1feee90a-d664-433f-81cf-1c00aa5534f8",
      "name": "Get Detail list Chat User2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7280,
        620
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9fd9da20-5532-4026-8eff-b6e09856d627",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fd0812f8-2490-4565-a43b-98852258fcc6",
      "name": "Check Client Tracked Before",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -8940,
        3060
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.messages.data[0].from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c5f28913-86b8-4865-b47e-a0968236d945",
      "name": "Get Tracked",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -9120,
        3060
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get Detail list Chat User2').item.json.messages.data[0].from.id }}",
            "client_name": "={{ $('Get Detail list Chat User2').item.json.messages.data[0].from.name }}",
            "client": "={{ $('Get Detail list Chat User2').item.json.messages.data[0].from.id }}",
            "status": "open",
            "level": "1"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "0e86bd69-0f32-46c0-b231-ed70571cc78f",
      "name": "UP Level 1 - open",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -8660,
        2960
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e728f992-d3a6-498a-adf0-c5799f54f052",
              "leftValue": "={{ $json.email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "43d2c8cb-dc5f-478a-826f-cb6a6ba69e65",
      "name": "Check mail",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -8740,
        3200
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $('Aggregate6').all()) {\n  const mail = item?.json?.data[0]?.message;\n  console.log('arg', mail);\n\n  // Biểu thức chính quy kiểm tra email\n  const emailRegex = /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}\\b/\n  const foundEmail = mail ? mail.match(emailRegex) : null;\n\n  // Nếu có email thì gán vào myNewField, không thì trả về null\n  item.json.Email = foundEmail ? foundEmail[0] : null;\n}\n\nreturn $('Aggregate6').all();"
      },
      "id": "f7b4a8f8-9ef4-4850-97e4-1c0a92384cb8",
      "name": "Take mail",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3620,
        0
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get Detail list Chat User2').item.json.messages.data[0].from.id }}",
            "client_name": "={{ $('Get Detail list Chat User2').item.json.messages.data[0].from.name }}",
            "client": "={{ $('Get Detail list Chat User2').item.json.messages.data[0].from.id }}",
            "email": "={{ $('Take mail').item.json.Email }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "df2700da-e674-4ede-a897-e29dd7822f12",
      "name": "Append",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -7160,
        2620
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "getmany",
        "additionalFields": {
          "searchLead": "={{ $json.emailConvert }}"
        },
        "requestOptions": {}
      },
      "id": "08866277-6203-42e8-a873-8ddb0bf8213d",
      "name": "Get Client By Email",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -8300,
        3200
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Check mail').item.json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Thank you. I have received your information. It seems that you do not have any activity in our system at the moment. To ensure we can support you effectively and keep everything organized, we have created a contact on our system.\\nYou access the link: https://worksuite.cloodo.com/login \\nWith Account: {{ $('Check mail').item.json.email }}\\nPassword: x7M&dL!9wQ#2tV4% \\nIs there anything you need assistance with?\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "7e8a00dd-dd3f-4efc-abcc-1c4deabb5891",
      "name": "send message3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7620,
        3400
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $json.client_name }}, thank you for reaching out. I’m here to assist you with your project needs. Could you share a bit more about what you’re looking for assistance with?\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "b2981d08-9227-4f2a-a07e-616f43b48e2f",
      "name": "send reply client new",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8480,
        2960
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"I have received your feedback. It would be helpful to have more details. Also, could you please share your contact information, preferably your email, so that we can exchange content more easily?\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "7b1fd08a-3c15-4068-8760-fcfbdac6d18f",
      "name": "send client no email",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8560,
        3400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d1298c9e-de46-4b53-8ab5-85d8f42d2dbc",
              "leftValue": "={{ $json.data }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2de45cdf-956b-48ca-8bc1-9fb4a571f52c",
      "name": "check mail client",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -8120,
        3180
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Check mail').item.json.client_name }}\",\n    \"email\": \"{{ $('Check mail').item.json.email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $json.data.user.id }}\"\n}",
        "options": {}
      },
      "id": "05ded1b5-2675-4dfb-a01a-f4a4a02ba2c6",
      "name": "Update contact client",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7800,
        3360
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Check mail').item.json.id }}",
            "client_name": "={{ $('Check mail').item.json.client_name }}",
            "client": "={{ $('Check mail').item.json.client }}",
            "email": "={{ $('Check mail').item.json.email }}",
            "level": "2",
            "status": "account"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "847500c8-5f0e-40b2-b520-5ad152706062",
      "name": "UP Level  2 account",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -7440,
        3480
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2d4dda6b-c9a9-48ef-96a2-48d021bc255f",
              "leftValue": "={{ $json.Email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "514b0d71-01e1-4a13-8b83-a551bbb04829",
      "name": "mail",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3460,
        0
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "95f210d6-a36c-48b9-a9cc-14a8da4eb191",
      "name": "Get Tracked1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -6660,
        600
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e728f992-d3a6-498a-adf0-c5799f54f052",
              "leftValue": "={{ $json.email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "269c7a16-3a38-465c-ae16-21f94a0aaf5c",
      "name": "Check mail1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -6460,
        600
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "additionalFields": {
          "client_id": "={{ $('check mail client').item.json.data[0].user.id }}"
        },
        "requestOptions": {}
      },
      "id": "eaf501ea-4058-4ec2-aa5d-1b861cc045bc",
      "name": "Get Project By Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -7700,
        3100
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "create",
        "projectName": "={{ $('Get Client By Email').item.json.data[0].user.name }} Project",
        "start_date": "={{ $now }}",
        "user_id": "=[\"{{ $('Get Client By Email').item.json.data[0].added_by.id }}\"]",
        "additionalFields": {
          "client_id": "=\"{{ $('Get Client By Email').item.json.data[0].user.id }}\""
        },
        "requestOptions": {}
      },
      "id": "1e0c94ab-17da-42dc-a36f-440851e27be2",
      "name": "Create Project",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -7320,
        3240
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "task",
        "operation": "create",
        "heading": "=Hi {{ $json.data.members[0].name }}! Please take care project of {{ $json.data.client.user.name }}",
        "start_date": "={{ $now }}",
        "due_date": "={{ $now.plus(1, 'month') }}",
        "users": "={{ $json.data.members[0].id }}",
        "additionalFields": {
          "ProjectID": "={{ $json.data.id }}",
          "taskCategoryId": "494589d7-f5da-4aa0-823a-4f7865cde09b"
        },
        "requestOptions": {}
      },
      "id": "0257c14e-fa81-4c9d-97c1-47b286152385",
      "name": "Create Task Take Care",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -7160,
        3240
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Check mail').item.json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Check mail').item.json.client_name }},\\nIt seems that you currently don’t have any active projects in our system. To ensure we can assist you effectively and keep everything well-organized, we’ve gone ahead and created a project for you.\\nYou can access the project here: https://worksuite.cloodo.com/apps/work/project/{{ $('Create Project').item.json.data.id }}/ \\nFeel free to check it out and let us know if there’s anything specific you’d like to add. We’re here to help with whatever you need!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "212a6430-a0c2-4db5-b3f4-9378edbde34a",
      "name": "send message",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7000,
        3240
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Check mail').item.json.id }}",
            "level": "2",
            "status": "created_project",
            "admin": "112710510078308",
            "project_name_support": "={{ $('Create Project').item.json.data.name }}",
            "id_project_support": "={{ $('Create Project').item.json.data.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "f39ecd9c-fe89-41d4-91a8-1ea4232f1158",
      "name": "UP Level  2 create project",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -6840,
        3220
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/clients",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"name\": \"{{ $('Check mail').item.json.client_name }}\",\n    \"email\": \"{{ $('Check mail').item.json.email }}\",\n    \"status\": \"active\",\n    \"password\": \"x7M&dL!9wQ#2tV4%\"\n}",
        "options": {}
      },
      "id": "49cf203a-5d1b-4171-83ab-fee0ae9395c1",
      "name": "HTTP Request3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7960,
        3340
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('Get Id Store').item.json.data[0].id }}/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "limit",
              "value": "25"
            },
            {
              "name": "after",
              "value": "={{ $json.next }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "782946e5-4670-4caf-90c6-3538e066010e",
      "name": "Get Detail list Chat User3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4340,
        1540
      ]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/112710510078308/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $json.id }}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "594cc5ab-cd92-44f5-a07e-7d6d53118e2e",
      "name": "Get Id Store",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4560,
        1540
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.next }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "9ff2dde1-d52d-44a1-af25-e44cca42080a",
      "name": "IF6",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -3880,
        1700
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const after = item?.json?.paging?.next;\n  console.log('after', after);\n\n  if (after && after.includes(\"after=\")) {\n    const valueAfterEqual = after.split(\"after=\")[1];\n    item.json.next = valueAfterEqual;\n\n    // Kiểm tra dữ liệu trả về từ Get Id Store\n    if ($node[\"Get Id Store\"]?.json?.data && $node[\"Get Id Store\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store\"]?.json?.data[0]?.id; // Lấy ID từ data[0]\n    } else {\n      console.log('No data found in Get Id Store');\n    }\n  } else {\n    item.json.next = null; // Nếu không có 'after=', gán null vào next\n     if ($node[\"Get Id Store\"]?.json?.data && $node[\"Get Id Store\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store\"]?.json?.data[0]?.id;\n     }\n  }\n}\n\nreturn $input.all();"
      },
      "id": "e730dfa0-9230-446f-a2e1-56f2a0678416",
      "name": "Take Page Next",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4140,
        1540
      ]
    },
    {
      "parameters": {
        "jsCode": "return null;"
      },
      "id": "d4f44b05-a882-405c-a2dc-70356dc7f811",
      "name": "Code1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3660,
        1720
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "a62ca719-d8e0-4bd4-96c7-985bc6471567",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -3260,
        1560
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate1']?.json?.data;\nlet document = '';\n\n// Start the document with a header\ndocument += 'List Messages sent by client with admin: \\n';\n\nfor (const item of listMessages.reverse()) {\n  // Check if the message is sent by Admin or Client\n  document += `${item?.from?.id == 112710510078308 ? 'Admin send: ' : 'Client sent: '} `;\n\n  // If the message contains text, use that. Otherwise, process attachments (images)\n  if (item?.message) {\n    document += `${item.message} \\n\\n`;\n  } else if (item?.attachments?.data && item.attachments.data.length > 0) {\n    // Process multiple images if available\n    const imageUrls = item.attachments.data\n      .filter(attachment => attachment.image_data?.url) // Filter only images\n      .map(attachment => attachment.image_data.url); // Extract image URLs\n\n    document += `Images: \\n`;\n    document += imageUrls.join(\"\\n\") + \"\\n\\n\"; // Join all image URLs with newlines\n  }\n}\n\n// Add the last message sent by the client\nconst lastMessage = listMessages[listMessages.length - 1];\ndocument += `\\n\\nLast message sent by client: `;\n\nif (lastMessage?.message) {\n  document += lastMessage.message ? lastMessage.message : '';\n} else if (lastMessage?.attachments?.data && lastMessage.attachments.data.length > 0) {\n  // Process multiple images in the last message\n  const lastImageUrls = lastMessage.attachments.data\n    .filter(attachment => attachment.image_data?.url)\n    .map(attachment => attachment.image_data.url);\n  document += `Images: \\n`;\n  document += lastImageUrls.join(\"\\n\"); // Join all image URLs with newlines\n}\n\nconsole.log(document);\n\nreturn { messagesSent: document };\n\n// const listMessages = $node['Aggregate1']?.json?.data\n// let document =''\n// document+='List Messages sent by client with admin: \\n'\n// for (const item of listMessages.reverse()) {\n//   document+= `${item?.from?.id == 112710510078308 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\n\\n`\n// }\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\n// console.log(document)\n// return {messagesSent: document};"
      },
      "id": "aabed508-766a-4572-a54a-5cd9014b952a",
      "name": "Get All Messages",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2500,
        1560
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "1a3092ca-8eac-43ec-8a76-9ba3605901f6",
      "name": "Get messages according to id",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2880,
        1560
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "=data",
        "options": {}
      },
      "id": "59bef34e-8765-4300-b528-db07122b7b08",
      "name": "Aggregate1",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2680,
        1560
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "3222ac7d-cac5-4419-b03d-82247f745e8a",
      "name": "Save messaage",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -3660,
        1520
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "64ba3cc6-8707-4d94-8595-a21c685474b4",
      "name": "Split Out1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -3880,
        1520
      ]
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "a8ed3686-5cd6-4486-adc5-a1f567188925",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -3460,
        1560
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "options": {}
      },
      "id": "1760d4c1-1d06-4ab7-9b2c-53c8655519ae",
      "name": "Save messaage1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -3060,
        1560
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8dd5f6e1-5663-4875-9a95-0ef4f4cc4b33",
              "name": "messagesSent",
              "value": "={{ $('Get All Messages').item.json.messagesSent }}",
              "type": "string"
            },
            {
              "id": "32b12d76-b7d0-45e2-bb6e-79e2471d3d00",
              "name": "project.name",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].name }}",
              "type": "string"
            },
            {
              "id": "6256a5cf-e613-4a5e-97cd-2a7577d602d0",
              "name": "project.status",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].status }}",
              "type": "string"
            },
            {
              "id": "507895aa-b100-48f3-91f4-b73275d561ce",
              "name": "project.start_date",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].start_date }}",
              "type": "string"
            },
            {
              "id": "6188ba61-5d09-4981-9897-9c51baebf721",
              "name": "project.deadline",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].deadline }}",
              "type": "string"
            },
            {
              "id": "21d301e8-3923-48a7-8fb6-a3a7bb808464",
              "name": "project.members",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].members }}",
              "type": "array"
            },
            {
              "id": "b6b31ed5-06b9-4d6e-b123-3a3542340022",
              "name": "client",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].client }}",
              "type": "object"
            },
            {
              "id": "597832ff-562f-437a-b31b-aa1080688fc8",
              "name": "project.milestone",
              "value": "={{ $json.data }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "id": "8e97b274-f699-47c7-bcfb-d4f43bd913bd",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2140,
        1560
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "getMilestones",
        "ID": "={{ $('Get Project CMS By Client').item.json.data[0].id }}",
        "additionalFields": {
          "limit": "50"
        },
        "requestOptions": {}
      },
      "id": "4d9cf444-fc98-4386-98d7-841cacbfac24",
      "name": "Cloodo Milestone",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -2320,
        1560
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "e383008e-f210-4e47-919b-635965d809d9",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -2140,
        1800
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=8db38109-d083-45b4-8cb4-60f16cd5bbf9"
      },
      "id": "e3c36a35-587a-4b89-9399-b4e694df36d4",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -2020,
        1860
      ]
    },
    {
      "parameters": {
        "name": "create_new_project",
        "description": "Call this tool to creat new project. The input should be are name of project and summary of project",
        "workflowId": {
          "__rl": true,
          "value": "sb2EG9FHeaSelWmb",
          "mode": "list",
          "cachedResultName": "Messager - Create New Project"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "member_project",
              "stringValue": "={{ $('Get CLient CMS By Email1').item.json.data[0].added_by.id }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields').item.json.client.id }}"
            }
          ]
        }
      },
      "id": "6e742ec3-7dd1-44ba-9e45-028e4c47c164",
      "name": "create_new_project",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -1840,
        1920
      ]
    },
    {
      "parameters": {
        "name": "resolve_problem_ticket",
        "description": "Call this tool to resolve problem ticket when client want to support with their ticket. The input should be is number of ticket",
        "workflowId": {
          "__rl": true,
          "value": "vNXQba5R8WXZU80n",
          "mode": "list",
          "cachedResultName": "Messager - Resolve proplem of Ticket"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields').item.json.client.id }}"
            }
          ]
        }
      },
      "id": "1aa41150-e83b-4df2-b9de-f582dbd9f743",
      "name": "resolve_problem_ticket",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -1560,
        1940
      ]
    },
    {
      "parameters": {
        "name": "ask_info_project",
        "description": "Call this tool to reply client when client ask about their project.\n",
        "workflowId": {
          "__rl": true,
          "value": "uwwKHWODM7aWEuym",
          "mode": "list",
          "cachedResultName": "Messager - Reply Info Project"
        },
        "fields": {
          "values": [
            {
              "name": "project_id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id_project_support }}"
            },
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            }
          ]
        }
      },
      "id": "7301bc9d-afa7-48fd-aae6-65e1731db7a0",
      "name": "ask_info_project",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -1700,
        1960
      ]
    },
    {
      "parameters": {
        "name": "take_care_client",
        "description": "Call this tool to help customers with their requests such as adding new features, processing refunds, invoice, estimate or other tasks. The input data for the request is the issue they need support for.",
        "workflowId": {
          "__rl": true,
          "value": "numrldAg1SjimdfF",
          "mode": "list",
          "cachedResultName": "Messager - Take care Client"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields').item.json.client.id }}"
            }
          ]
        }
      },
      "id": "3eb879be-b83d-49a7-a9d9-3c686aa3659a",
      "name": "take_care_client",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -1420,
        1900
      ]
    },
    {
      "parameters": {
        "name": "summary_chat_session",
        "description": "Call this tool to perform a summary of the issues discussed with the customer during that session when the customer's issue requiring support has been resolved and the customer has no further requests. The request data is the customer's message confirming that their issue has been resolved and that there are no further requests.",
        "workflowId": {
          "__rl": true,
          "value": "C708LJNJFvQVWna7",
          "mode": "list",
          "cachedResultName": "Messager - Summary chat Session"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields').item.json.client.id }}"
            }
          ]
        }
      },
      "id": "8f9c2efb-7d67-47a7-8a66-d77b1399f796",
      "name": "summary_chat_session",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -1280,
        1840
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Switch Quantity Project2').item.json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "fe6b9956-426d-4f5f-ba7f-1a6cc6a62428",
      "name": "send message2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -340,
        1540
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "51d163c9-5926-4169-a8a7-8a0cdeb98caa",
              "leftValue": "={{ $json.messages.data[0].from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "969c3ff8-c577-40ac-9cd3-e60ea6085d32",
      "name": "Last send by Client1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1240,
        1560
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('Get Id Store').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "069673ae-67f0-4b75-9854-9a3c34ba12fa",
      "name": "Get Detail list Chat User4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1420,
        1560
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['AI Agent']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "9d84f3f9-5d7f-4fce-8291-ef9da753adfe",
      "name": "Code3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -540,
        1540
      ]
    },
    {
      "parameters": {
        "jsCode": "\nfor (const item of $input.all()) {\n  const email = item?.json?.email;\n  if (email) {\n    item.json.emailConvert = email.replace(/\\..+$/, '');\n  }\n  //item.json.emailConvert = email;\n}\n\nreturn $input.all();"
      },
      "id": "571260e3-2a91-437c-84d0-8e79affd85e0",
      "name": "Code4",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8480,
        3180
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Check mail').item.json.client_name }}\",\n    \"email\": \"{{ $('Get Detail list Chat User2').item.json.messages.data[0].from.email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $json.data[0].user.id }}\"\n}",
        "options": {}
      },
      "id": "3d50e8fe-1642-462b-b511-d1533f224e66",
      "name": "Update contact client1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7860,
        3100
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 1271 AND user_chats.to = {{ $('MySQL Get Info Client').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client').item.json.id }} AND user_chats.to = 1271)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 1271 AND user_chats.to = {{ $('MySQL Get Info Client').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client').item.json.id }} AND user_chats.to = 1271) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "49b6d4b2-a723-4f99-9500-5809868147c0",
      "name": "MySQL Get Detail Messages1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -1960,
        2240
      ],
      "credentials": {
        "mySql": {
          "id": "zeIUsGdBlo7sjOHL",
          "name": "Printcart Database"
        }
      }
    },
    {
      "parameters": {
        "resource": "chat",
        "chatModel": "gpt-4o",
        "prompt": {
          "messages": [
            {
              "role": "assistant",
              "content": "=Given the list of project names provided below and the conversation messages between the client and admin, determine which project the client needs support with. Please follow these steps:\n\nReview the Project List and Conversation Messages provided below.\nFollow the chronological sequence of messages based on the \"Time Send\" timestamps.\nIf the client directly mentions a project (even partially), return only exactly the name of project follow list name project below.\nIf the client does not directly mention any project or the project cannot be identified from the conversation, return 'notfound'.\n\nProject List: {{ $('Aggregate9').item.json.data.map(item => `${item.name}`).join('\\n') }}\n\nConversation Messages: {{ $('Get All Messages2').item.json.messagesSent }}\n"
            }
          ]
        },
        "simplifyOutput": "=true",
        "options": {
          "maxTokens": 1600
        },
        "requestOptions": {}
      },
      "id": "4119eae2-2e75-41db-9435-02da2419c088",
      "name": "OpenAI2",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1.1,
      "position": [
        -1040,
        2720
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate2']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.user_one == 1271 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "c1d83b0d-d38f-4209-a61d-5ea7fb3e2fcf",
      "name": "Get All Messages1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1580,
        2240
      ]
    },
    {
      "parameters": {
        "messageImport": "=I hope you're doing well! 😊\n\nIt looks like you're working on {{ $json.projectFound[0].name }}, and I wanted to check in with you to see if there's anything specific you need help with at the moment. Is there any issue or feature you'd like assistance on? Feel free to let me know, and I'll be happy to assist you in any way I can!\n\nLooking forward to hearing from you!",
        "userId": "={{ $('Get Tracked').item.json.client }}"
      },
      "id": "aa05b0bc-6667-4fda-839e-fb434ff576de",
      "name": "Require Confirm Project1",
      "type": "@cloodo/n8n-nodes-workchat.workchat",
      "typeVersion": 1,
      "position": [
        -7220,
        3780
      ],
      "credentials": {
        "workchatTokenApi": {
          "id": "vmWmvYNeiMEbsF91",
          "name": "Workchat Printcart Admin"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "project_name_support": "={{ $('Get Project support').item.json.projectFound[0].name }}",
            "id_project_support": "={{ $('Get Project support').item.json.projectFound[0].id }}",
            "level": "3",
            "status": "confirm_project",
            "id": "={{ $('Switch2').item.json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {
          "useAppend": true
        }
      },
      "id": "19d03338-525b-4611-b4b3-d1f1f97c8707",
      "name": "UP Level 3 - confirm_project1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -380,
        2720
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get Tracked').item.json.id }}",
            "status": "ask_project",
            "level": "3",
            "list_id_project": "={{ $('Get Project By Client').item.json.data.map(item=>item.id) }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "fff5e2d3-98ae-426e-b4e6-55c38125c6fb",
      "name": "UP Level 3 - ask_project",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2660,
        2180
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1ISub6AhptvE9Ac-U2fQW_7Ya0EknULgME0O1i9mLtM0",
          "mode": "list",
          "cachedResultName": "Check error account and auto answer ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ISub6AhptvE9Ac-U2fQW_7Ya0EknULgME0O1i9mLtM0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 573714152,
          "mode": "list",
          "cachedResultName": "Follow Client",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ISub6AhptvE9Ac-U2fQW_7Ya0EknULgME0O1i9mLtM0/edit#gid=573714152"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "level": "3",
            "status": "ask_project",
            "id": "={{ $('Get Tracked').item.json.id }}",
            "id_project_support": "wait confirm",
            "project": "={{ $('Get Project By Client').item.json.data.map(item=>item.id) }}",
            "project_name": "={{ $('Get Project By Client').item.json.data.map(item=>item.name) }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project",
              "displayName": "project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name",
              "displayName": "project_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "name_project_support",
              "displayName": "name_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "c737e172-b834-418b-883b-e6ab4085d10b",
      "name": "UP Level 3 - ask_project1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2440,
        2180
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let project =[]\nconst nameProjectFind = $input.all()[0].json.message.content.trim()\nfor (const item of $('Aggregate9').all()[0]?.json?.data) {\n  if(nameProjectFind == item?.name){\n     let projectItem ={\n    id: item?.id,\n    name: item?.name\n  }\n  project.push(projectItem)\n    break\n  }\n \n}\n\nreturn {projectFound: project};"
      },
      "id": "a9b8cbcd-99b5-432d-9b17-000b4a244a8a",
      "name": "Get Project support",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -840,
        2720
      ]
    },
    {
      "parameters": {
        "jsCode": "let project =[]\nfor (const item of $input.all()[0].json.data) {\n  let projectItem ={\n    id: item?.id,\n    name: item?.name\n  }\n  project.push(projectItem)\n}\n\nreturn {listProject: project};"
      },
      "id": "428720ba-9407-4e4f-8a84-651ef83b8cad",
      "name": "Code5",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3100,
        2180
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "3444b9eb-1015-4027-9a9f-95f28c6a60f5",
      "name": "Aggregate2",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1780,
        2220
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('Get Id Store1').item.json.data[0].id }}/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "limit",
              "value": "25"
            },
            {
              "name": "after",
              "value": "={{ $json.next }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "78afe407-b485-48e8-9ca4-769a0b9c84d5",
      "name": "Get Detail list Chat User5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3840,
        2640
      ]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/112710510078308/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $('Switch2').item.json.client }}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "7b8be8b4-1e1e-40ae-acbd-bb6a99df7146",
      "name": "Get Id Store1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4080,
        2620
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.next }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "d40c11b5-c0a7-4176-a3d9-ea9433b91d78",
      "name": "IF",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -3520,
        2820
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const after = item?.json?.paging?.next;\n  console.log('after', after);\n\n  if (after && after.includes(\"after=\")) {\n    const valueAfterEqual = after.split(\"after=\")[1];\n    item.json.next = valueAfterEqual;\n\n    // Kiểm tra dữ liệu trả về từ Get Id Store\n    if ($node[\"Get Id Store1\"]?.json?.data && $node[\"Get Id Store1\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store1\"]?.json?.data[0]?.id; // Lấy ID từ data[0]\n    } else {\n      console.log('No data found in Get Id Store');\n    }\n  } else {\n    item.json.next = null; // Nếu không có 'after=', gán null vào next\n     if ($node[\"Get Id Store1\"]?.json?.data && $node[\"Get Id Store1\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store1\"]?.json?.data[0]?.id;\n     }\n  }\n}\n\nreturn $input.all();"
      },
      "id": "affc9f71-ed67-4b73-93ba-77f7847fa24b",
      "name": "Take Page Next1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3660,
        2640
      ]
    },
    {
      "parameters": {
        "jsCode": "return null;"
      },
      "id": "9d0720b6-5bed-4f14-9da5-770d7b890a7f",
      "name": "Code6",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3280,
        2840
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "5bd2fd9c-87a9-4506-8a1f-4054b3fa8694",
      "name": "Aggregate3",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2840,
        2720
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate4']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.from?.id == 112710510078308 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\n\\n`\n}\n\ndocument+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "4e30ccb6-c720-42f8-8e07-057b8586504c",
      "name": "Get All Messages2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2080,
        2720
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "12c080df-8811-4973-8a28-befd81220699",
      "name": "Get messages according to id1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2460,
        2720
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "=data",
        "options": {}
      },
      "id": "2048ea34-5737-4b47-894f-6d1f7357812f",
      "name": "Aggregate4",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2280,
        2720
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "2f7f8fe5-bdc4-4197-8c74-d1f04bd3508f",
      "name": "Save messaage3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -3240,
        2580
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "111dc36a-47a3-4acb-99af-b57e62111bfe",
      "name": "Split Out3",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -3460,
        2580
      ]
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "b7fc6ddd-5b9d-4c08-979c-b5dcd81beb85",
      "name": "Merge1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -3040,
        2720
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "options": {}
      },
      "id": "686482d9-d539-4c49-bfe5-4ea8a61b6375",
      "name": "Save messaage4",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2640,
        2720
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get Tracked3').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"I hope you're doing well! 😊\\nIt looks like you're working on {{ $json.projectFound[0].name }}, and I wanted to check in with you to see if there's anything specific you need help with at the moment. Is there any issue or feature you'd like assistance on? Feel free to let me know, and I'll be happy to assist you in any way I can!\\nLooking forward to hearing from you!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6fbcce2f-08ed-4868-8f4c-267ec68b1192",
      "name": "send message5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -620,
        2720
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "numberToDelete": 200
      },
      "id": "ab91e48c-f1e0-41f5-b157-ebce6de67023",
      "name": "Delete message1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -140,
        2720
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "numberToDelete": 200
      },
      "id": "aedc7b19-5547-4c3c-b82a-a4ff9889f80f",
      "name": "Delete message",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        2180
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {},
      "id": "dc3eeda3-167d-4735-859d-3663efc876c4",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -8040,
        860
      ],
      "disabled": true
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/112710510078308/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "after"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3873c515-7ef3-45fc-a589-568809285c37",
      "name": "Get many list chat",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8880,
        2640
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "04a13340-f2e9-43c6-8b3f-59622c8c42f5",
      "name": "Item Lists",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        -8600,
        2640
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "participants "
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {}
      },
      "id": "b300dab6-507d-43c4-88f0-3b42fc6242c5",
      "name": "Get Id User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8340,
        2640
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "61148bd8-a337-457a-be43-9b9875bbd970",
      "name": "Get Detail list Chat User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8080,
        2640
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "51d163c9-5926-4169-a8a7-8a0cdeb98caa",
              "leftValue": "={{ $json.messages.data[0].from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5b3864f2-8153-4dc1-b1fd-268c6bad0f67",
      "name": "Last send by Client",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -7880,
        2640
      ]
    },
    {
      "parameters": {
        "functionCode": "return items;"
      },
      "name": "Function",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -7900,
        620
      ],
      "id": "d5f6d1cb-87d6-48d1-b7e5-a491052cd068"
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/112710510078308/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $json.body.senderId }}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BO3pe1XAVU6TdQireGrFhQuA0VNvdVVQZA7sTcCOxHsLgNTGHDqfVpEJHZAM6RgUC5Hzz2kGeiNcGZBzP1x8iSi1eqakD3UgOF2BlwQIncNQAavaNc28uVAy5XbbWwNukbwVrDB3JBQRbZBxxpummuVNaQLjKRurdcYPY9LF9iSoWcsxziaoZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "459e0ccf-73de-45b9-b694-6fa063c4fa42",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7480,
        620
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "facebook",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -8120,
        620
      ],
      "id": "6e9e1792-f8f3-4fa3-ac4c-8e379bcae776"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e76054dc-48a2-4397-b175-59036d1b40a7",
                    "leftValue": "={{ $json.data.length > 1 && $('Get Tracked').item.json.id_project_support.length == 0 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "many project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.length == 1 || $('Get Tracked').item.json.id_project_support.length > 0  }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "one project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ab0029d6-411d-465d-bdc7-860e02569893",
                    "leftValue": "={{ $json.data }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "empty project"
            }
          ]
        },
        "options": {}
      },
      "id": "566c4735-b101-4fa8-8e48-2a1b13c82f32",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -7500,
        3100
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.messages.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to,created_time"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "7730654f-9ac2-4892-a510-b503848b1ac5",
      "name": "Get Detail Last list Chat User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7080,
        620
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a4bb989a-d243-4888-87d3-773e405fa336",
              "leftValue": "={{ $json.from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "264909f4-3c00-4597-af3f-e4ba4208da7d",
              "leftValue": "={{ new Date($json.created_time.replace(' ', 'T').replace('+0000', '+07:00')).getTime() }}",
              "rightValue": "={{ new Date(Date.now() - 0.4 * 60 * 1000).getTime() }}",
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e2031cc9-b29c-4ee4-a202-75e89456998a",
      "name": "Last send by client",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -6880,
        620
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('Get Id Store2').item.json.data[0].id }}/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "limit",
              "value": "25"
            },
            {
              "name": "after",
              "value": "={{ $json.next }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "c2496f49-2a4f-494a-8390-b99acd958bcd",
      "name": "Get Detail list Chat User6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6040,
        -20
      ]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/112710510078308/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $('Last send by client').item.json.from.id }}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "f3f774fb-43ec-4c76-b85a-00bc1a0253e5",
      "name": "Get Id Store2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6260,
        -20
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.next }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "a9efb2e1-e6cd-4a00-94d6-cdb156306051",
      "name": "IF7",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -5680,
        80
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const after = item?.json?.paging?.next;\n  console.log('after', after);\n\n  if (after && after.includes(\"after=\")) {\n    const valueAfterEqual = after.split(\"after=\")[1];\n    item.json.next = valueAfterEqual;\n\n    // Kiểm tra dữ liệu trả về từ Get Id Store\n    if ($node[\"Get Id Store2\"]?.json?.data && $node[\"Get Id Store2\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store2\"]?.json?.data[0]?.id; // Lấy ID từ data[0]\n    } else {\n      console.log('No data found in Get Id Store');\n    }\n  } else {\n    item.json.next = null; // Nếu không có 'after=', gán null vào next\n     if ($node[\"Get Id Store2\"]?.json?.data && $node[\"Get Id Store2\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store2\"]?.json?.data[0]?.id;\n     }\n  }\n}\n\nreturn $input.all();"
      },
      "id": "69669661-acd2-4b48-a92d-7558c732b4c2",
      "name": "Take Page Next2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5860,
        -20
      ]
    },
    {
      "parameters": {
        "jsCode": "return null;"
      },
      "id": "aec6c435-e5b2-4ce6-bcd7-776bf5432f63",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5440,
        100
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "ee0946e2-edf7-4137-8b93-f8b6a9774757",
      "name": "Aggregate5",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -5120,
        -60
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate6']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.from?.id == 112710510078308 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\n\\n`\n}\n\ndocument+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "e1363cd5-5b80-457b-bce1-7c660e218b6d",
      "name": "Get All Messages3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4320,
        -60
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3803f9c3-9e39-488a-a0f9-8d72a147a6e1",
      "name": "Get messages according to id2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4720,
        -60
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "=data",
        "options": {}
      },
      "id": "83f1195d-ba44-4978-81fe-3ebfda4b9a77",
      "name": "Aggregate6",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -4520,
        -60
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "7b5564a7-a442-4f65-a3d6-5b5f20ba4c2f",
      "name": "Save messaage2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -5500,
        -140
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "16447301-78c8-4f7d-a073-c01ee685e287",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -5700,
        -120
      ]
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "2b4b4eb0-f7c2-4059-8dcd-a835d1e3aeb3",
      "name": "Merge2",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -5300,
        -60
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "options": {}
      },
      "id": "2180f165-913f-4525-b280-3f051055e242",
      "name": "Save messaage5",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4920,
        -60
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate8').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Aggregate8').item.json.data[0].from.name }}, thank you for reaching out. I’m here to assist you with your project needs. Could you share a bit more about what you’re looking for assistance with?\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "755331df-316d-42ca-a779-f28a0accc5bb",
      "name": "send welcome",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2340,
        1020
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Aggregate8').item.json.data[0].from.id }}",
            "Company": "={{ $('Aggregate6').item.json.data[0].to.data[0].name }}",
            "client": "={{ $('Aggregate6').item.json.data[0].from.id }}",
            "client_name": "={{ $('Aggregate6').item.json.data[0].from.name }}",
            "level": "1",
            "status": "open",
            "admin": "={{ $('Aggregate6').item.json.data[0].to.data[0].id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "96344981-bc01-4c96-8f6f-7b22069417b5",
      "name": "UP Level 1 - open1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2120,
        1020
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "8db38109-d083-45b4-8cb4-60f16cd5bbf9"
      },
      "id": "7c5fbbcf-df57-4c5b-b8ef-b91f64fb49c4",
      "name": "Window Buffer Memory3",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -2440,
        940
      ]
    },
    {
      "parameters": {
        "jsCode": "const content = $input.all()[0].json.output\n\nlet jsonString = content.match(/{[\\s\\S]*}/)[0];\nlet jsonObject = JSON.parse(jsonString);\n\njsonObject.message = jsonObject.message.replace(/\\n/g, '<br>');\n\n// Replace ** with <strong> tags for bold text\njsonObject.message = jsonObject.message.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');\n\n// Replace * with <em> tags for italic text\njsonObject.message = jsonObject.message.replace(/\\*(.*?)\\*/g, '<em>$1</em>');\nconsole.log(jsonString)\n\n// Parse the JSON string into an object\n\n\nreturn jsonObject;"
      },
      "id": "d85cc468-7b2f-4340-a404-dfd4466eb94c",
      "name": "Get Info Issue1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2120,
        780
      ],
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "return{\n  \n\n    \"headers\": {\n      \"host\": \"workflow.cloodo.com\",\n      \"user-agent\": \"axios/1.7.9\",\n      \"content-length\": \"73\",\n      \"accept\": \"application/json, text/plain, */*\",\n      \"accept-encoding\": \"gzip, compress, deflate, br\",\n      \"content-type\": \"application/json\",\n      \"x-forwarded-for\": \"207.244.255.94\",\n      \"x-forwarded-host\": \"workflow.cloodo.com\",\n      \"x-forwarded-port\": \"443\",\n      \"x-forwarded-proto\": \"https\",\n      \"x-forwarded-server\": \"40c48caec682\",\n      \"x-real-ip\": \"207.244.255.94\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": {\n      \"senderId\": \"28851023821155122\",\n      \"message\": \"Is anyone available to chat?\"\n    },\n    \"webhookUrl\": \"https://workflow.cloodo.com/webhook/4U0MYdkQXyKV45RF/webhook/facebook\",\n    \"executionMode\": \"production\"\n\n  \n\n}"
      },
      "id": "13828963-83cb-4bad-bec9-8034908653a2",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7780,
        860
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  messagerAI = messagerAI.replace(/###/g, '');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "4894e63e-4350-4c2e-9146-2b10aa79cf7c",
      "name": "Code7",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2140,
        1220
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate8').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "d58341ae-590f-4502-b716-a89cd06584dd",
      "name": "send welcome1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1900,
        1220
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI1']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "87aeddbf-bf1d-4b10-9169-d06b2cc25ce1",
      "name": "Code8",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3220,
        -380
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate6').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "f8e996ad-9ca6-4cf0-bfdf-0da054d8c5c0",
      "name": "send welcome2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3020,
        -380
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "problem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "18ae536c-a09d-463d-88e1-ab7a1f22013e",
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "email",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "email"
            }
          ]
        },
        "options": {}
      },
      "id": "2fe98ab8-c445-489b-b95f-6244d3d8f5d1",
      "name": "Switch3",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -3780,
        -60
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate6').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Dear{{ $('Aggregate6').item.json.data[0].from.name }},\\nI’m reaching out regarding the email address you provided. Unfortunately, it appears that the email is incomplete or missing. Could you kindly provide the correct email address at your earliest convenience? This will help us proceed with your request smoothly.\\n Thank you for your understanding and cooperation. Please let me know if you need any assistance with this.\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "149c6849-32e8-45f9-8834-8e64116533a8",
      "name": "remind mail",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2800,
        280
      ]
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "getmany",
        "page": "1",
        "additionalFields": {
          "searchLead": "={{ $json.Email }}"
        },
        "requestOptions": {}
      },
      "id": "445ab70e-b131-4f16-b68c-77eba9c0eaed",
      "name": "Get CLient CMS By Email",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -3280,
        -40
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not client"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fea13891-5065-4d09-807e-5ce6aabc432a",
                    "leftValue": "={{ $json.data.length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "is client"
            }
          ]
        },
        "options": {}
      },
      "id": "0517531b-0913-4ecf-8b3a-f91ee79f29b8",
      "name": "Switch4",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -3120,
        -40
      ]
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "create",
        "name": "={{ $('Take mail').item.json.data[0].from.name }}",
        "passwordClinet": "=qK8|*E04J}06",
        "clientEmail": "={{ $('Take mail').item.json.Email }}",
        "additionalFields": {
          "added_by": "ebe95d3f-2b79-47f6-bd5e-5d22d67d4f21"
        },
        "requestOptions": {}
      },
      "id": "bc46c808-8a15-45e7-8b5d-a2cc174d777f",
      "name": "Cloodo CRM Create New Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -2900,
        -160
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "create",
        "projectName": "= {{ $json.data.user.name.split(\"@\")[0] }} Project",
        "start_date": "={{ $now }}",
        "user_id": "=[\"{{ $json.data.added_by.id }}\"]",
        "additionalFields": {
          "client_id": "=\"{{ $json.data.user.id }}\""
        },
        "requestOptions": {}
      },
      "id": "ddeac69d-f1b1-4143-81ae-94c4076954a4",
      "name": "Create Project1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -2700,
        -160
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate6').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hello, {{ $('Take mail').item.json.data[0].from.name }} \\nTo provide you with the best support possible, we've created a new client account for you on our system. Please login using the email we've registered for you. For security reasons, we recommend setting a new password upon your first login. You can do this by visiting our website and following the instructions for 'Forgot Password' if needed.\\nUsername: {{ $('Take mail').item.json.Email }} \\nPassword: qK8|*E04J}06 \\nVisit our system: https://worksuite.cloodo.com/ \\nIf you have any questions during the process, feel free to reach out for assistance.\\nThank you for working with us!\\nLet me know if there's anything else you need or if there's any other way I can assist you!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "1dfdff5f-4614-48be-b8a0-4aef2ae670b0",
      "name": "send create account",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2340,
        -160
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Take mail').item.json.data[0].from.name }}\",\n    \"email\": \"{{ $('Take mail').item.json.data[0].from.email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $('Cloodo CRM Create New Client').item.json.data.user.id }}\"\n}",
        "options": {}
      },
      "id": "5084d28a-c76e-4648-8788-11797e9edf8a",
      "name": "Update contact client2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2520,
        -160
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "additionalFields": {
          "client_id": "={{ $json.data[0].user.id }}"
        },
        "requestOptions": {}
      },
      "id": "d5cc87ef-1344-4cfc-92c6-0fd7d5bc0450",
      "name": "Get Project CMS By Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -5980,
        1120
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "numberToDelete": 200
      },
      "id": "635891ac-ad19-46ee-b6c4-0c27f1fbed51",
      "name": "Delete message2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1580,
        60
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {},
      "id": "57929070-6959-4906-a889-c0d6f0b2e611",
      "name": "No Operation, do nothing1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1800,
        60
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $('Check mail1').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7db389a8-51b6-4e84-b21d-0091adf04c04",
      "name": "Get Tracked2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -5760,
        1120
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9fd9da20-5532-4026-8eff-b6e09856d627",
              "leftValue": "={{ $json.client.toString() }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9a62ea3b-56b6-4dbd-af35-65f0e8fb37d0",
      "name": "Check Client Not Tracked Before",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -5520,
        1600
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Take mail').item.json.data[0].from.name }}\",\n    \"email\": \"{{ $('Take mail').item.json.data[0].from.email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $json.data[0].user.id }}\"\n}",
        "options": {}
      },
      "id": "69f26630-1261-4b01-8db5-689c18bb82a7",
      "name": "Update contact client3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2900,
        40
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate6').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Thank you for providing the details. We’ve successfully received the information you’ve provided, and everything seems to be in order.\\nIn order to assist you further, could you kindly clarify the issue you are encountering? Please provide as much detail as possible so we can resolve it efficiently.\\nWe’re here to help, and we look forward to your response.\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "58019d1d-78f0-46c0-be7a-de9e6bc7b10b",
      "name": "send received email",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2660,
        40
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Take mail').item.json.data[0].from.id }}",
            "Company": "={{ $('Take mail').item.json.data[1].from.name }}",
            "client": "={{ $('Take mail').item.json.data[0].from.id }}",
            "client_name": "={{ $('Take mail').item.json.data[0].from.name }}",
            "email": "={{ $('Take mail').item.json.Email }}",
            "mailFacebook": "={{ $('Take mail').item.json.data[0].from.email }}",
            "level": "1",
            "status": "open"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "5285b4ad-8bb1-4913-ae6d-c02fad01a725",
      "name": "Append1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2120,
        -160
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Take mail').item.json.data[0].from.id }}",
            "Company": "={{ $('Take mail').item.json.data[1].from.name }}",
            "client": "={{ $('Take mail').item.json.data[0].from.id }}",
            "client_name": "={{ $('Take mail').item.json.data[0].from.name }}",
            "email": "={{ $('Take mail').item.json.Email }}",
            "mailFacebook": "={{ $('Take mail').item.json.data[0].from.email }}",
            "level": "1",
            "status": "open"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "96a47a9e-9f97-416e-92cc-98ff66cc002d",
      "name": "Append3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2400,
        40
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "content": "## {{ $json.body.senderId }}\n",
        "width": 318.78827753313925
      },
      "id": "7849aa9b-62e9-41c0-8788-f4ed327946fb",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -7520,
        400
      ]
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "getmany",
        "page": "1",
        "additionalFields": {
          "searchLead": "={{ $json.email }}"
        },
        "requestOptions": {}
      },
      "id": "5a867db9-d1d6-4805-b223-08927e75d547",
      "name": "Get CLient CMS By Email1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -6220,
        1120
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('Get Id Store3').item.json.data[0].id }}/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "limit",
              "value": "25"
            },
            {
              "name": "after",
              "value": "={{ $json.next }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "c03db3a7-c4ac-4b45-a4e1-bab6ce3b88d9",
      "name": "Get Detail list Chat User7",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -5100,
        1040
      ]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/112710510078308/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $('Last send by client').item.json.from.id }}"
            },
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "b6356ae3-6519-4825-b65d-b613f45038ea",
      "name": "Get Id Store3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -5320,
        1040
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.next }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "9a3aec55-6a4a-4eee-bd88-3a05dd2fdf08",
      "name": "IF8",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -4740,
        1140
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const after = item?.json?.paging?.next;\n  console.log('after', after);\n\n  if (after && after.includes(\"after=\")) {\n    const valueAfterEqual = after.split(\"after=\")[1];\n    item.json.next = valueAfterEqual;\n\n    // Kiểm tra dữ liệu trả về từ Get Id Store\n    if ($node[\"Get Id Store3\"]?.json?.data && $node[\"Get Id Store3\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store3\"]?.json?.data[0]?.id; // Lấy ID từ data[0]\n    } else {\n      console.log('No data found in Get Id Store');\n    }\n  } else {\n    item.json.next = null; // Nếu không có 'after=', gán null vào next\n     if ($node[\"Get Id Store3\"]?.json?.data && $node[\"Get Id Store3\"].json.data.length > 0) {\n      item.json.conver = $node[\"Get Id Store3\"]?.json?.data[0]?.id;\n     }\n  }\n}\n\nreturn $input.all();"
      },
      "id": "594987e7-02a9-458e-b08c-996ca781292d",
      "name": "Take Page Next3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4920,
        1040
      ]
    },
    {
      "parameters": {
        "jsCode": "return null;"
      },
      "id": "016d27dd-c3fd-4a77-9ece-bf77d0263e92",
      "name": "Code2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4500,
        1160
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "0406cd4c-f0bb-4d42-93ce-5262d716086d",
      "name": "Aggregate7",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -4120,
        1020
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate8']?.json?.data;\nlet document = '';\n\n// Start the document with a header\ndocument += 'List Messages sent by client with admin: \\n';\n\nfor (const item of listMessages.reverse()) {\n  // Check if the message is sent by Admin or Client\n  document += `${item?.from?.id == 112710510078308 ? 'Admin send: ' : 'Client sent: '} `;\n\n  // If the message contains text, use that. Otherwise, process attachments (images)\n  if (item?.message) {\n    document += `${item.message} \\n\\n`;\n  } else if (item?.attachments?.data && item.attachments.data.length > 0) {\n    // Process multiple images if available\n    const imageUrls = item.attachments.data\n      .filter(attachment => attachment.image_data?.url) // Filter only images\n      .map(attachment => attachment.image_data.url); // Extract image URLs\n\n    document += `Images: \\n`;\n    document += imageUrls.join(\"\\n\") + \"\\n\\n\"; // Join all image URLs with newlines\n  }\n}\n\n// Add the last message sent by the client\nconst lastMessage = listMessages[listMessages.length - 1];\ndocument += `\\n\\nLast message sent by client: `;\n\nif (lastMessage?.message) {\n  document += lastMessage.message ? lastMessage.message : '';\n} else if (lastMessage?.attachments?.data && lastMessage.attachments.data.length > 0) {\n  // Process multiple images in the last message\n  const lastImageUrls = lastMessage.attachments.data\n    .filter(attachment => attachment.image_data?.url)\n    .map(attachment => attachment.image_data.url);\n  document += `Images: \\n`;\n  document += lastImageUrls.join(\"\\n\"); // Join all image URLs with newlines\n}\n\nconsole.log(document);\n\nreturn { messagesSent: document };\n\n// const listMessages = $node['Aggregate8']?.json?.data\n// let document =''\n// document+='List Messages sent by client with admin: \\n'\n// for (const item of listMessages.reverse()) {\n//   document+= `${item?.from?.id == 112710510078308 ? 'Admin send: ' : 'Client sent: '} ${item?.message ? item?.message : item?.attachments?.data[0]?.image_data?.url} \\n\\n`\n// }\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message ? listMessages[listMessages.length-1].message : listMessages[listMessages.length-1]?.attachments?.data[0]?.image_data?.url}`\n// console.log(document)\n// return {messagesSent: document};"
      },
      "id": "fc23c674-36da-493c-ae0e-d91b5d81958c",
      "name": "Get All Messages4",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3360,
        1020
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to,attachments"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "46c28b4a-37fc-4571-9e47-808196f1f729",
      "name": "Get messages according to id3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3760,
        1020
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "=data",
        "options": {}
      },
      "id": "2a7fed76-f4c7-4ae7-a5de-17a84a232a81",
      "name": "Aggregate8",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -3560,
        1020
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "ad3436b9-0b9c-45b0-84e4-78a986e89fcd",
      "name": "Save messaage6",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4560,
        920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "88fe7cbb-2317-4d48-b9bc-435d4380b78e",
      "name": "Split Out2",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -4760,
        940
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "options": {}
      },
      "id": "15dbed66-644b-400f-89c1-5bc4d2b7d658",
      "name": "Save messaage7",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -3960,
        1020
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "err"
      },
      "id": "797cd488-949c-4e01-99e9-7a855d2b893e",
      "name": "Stop and Error",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -6100,
        2040
      ]
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "e301e914-bb36-4089-9420-01e399ddbcb6",
      "name": "Merge3",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -4320,
        1000
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1466582400,
          "mode": "list",
          "cachedResultName": "Message Facebook",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1466582400"
        },
        "numberToDelete": 200
      },
      "id": "a0e7feae-e927-4d43-a879-c49ecdf5afb1",
      "name": "Delete message3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1300,
        980
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {},
      "id": "08693815-f87c-4626-9906-c4ccb7ac2e3a",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1520,
        980
      ]
    },
    {
      "parameters": {
        "messageImport": "={{ $('Get Info Issue1').first().json.message }}\n\nYou can track and manage the ticket here: \n<a href=\"https://worksuite.cloodo.com/apps/tickets/all-tickets/{{ $json.data.id }}/\" target=\"_blank\">https://worksuite.cloodo.com/apps/tickets/all-tickets/{{ $json.data.id }}/ </a>\nIf you need more details or would like to discuss further, I can connect you with our team for additional support. Let me know how I can assist!  ",
        "userId": "={{ $('MySQL Get Info Client').item.json.id }}"
      },
      "id": "36e802f4-5d4b-4cce-83a0-85748fd051a1",
      "name": "Workchat Issue1",
      "type": "@cloodo/n8n-nodes-workchat.workchat",
      "typeVersion": 1,
      "position": [
        -1000,
        460
      ],
      "credentials": {
        "workchatTokenApi": {
          "id": "vmWmvYNeiMEbsF91",
          "name": "Workchat Printcart Admin"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/tickets",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"tags\": [],\n    \"project_id\":\"{{ $('Get Project CMS By Client').item.json.data[0].id }}\",\n    \"user_id\": \"{{ $json.data.client.user.id }}\",\n    \"subject\": \"{{ $('Get Info Issue1').first().json.subject }}\",\n    \"priority\": \"low\",\n    \"agent_id\": \"61fd7c82-41d1-4cd6-b63d-85b927bb7dff\",\n    \"type_id\": \"98170546-24fc-41b2-8741-70acbba38ef7\",\n    \"channel_id\": \"034701fa-62c1-4eff-9a10-c29571ad2c46\",\n    \"status\": \"open\",\n    \"message\": \"{{ $('Get Info Issue1').first().json.message }}\",\n    \"note\": \"\",\n    \"ticket_files\": []\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "9a3498b7-207c-42b5-a893-921fb3e36eae",
      "name": "Create Ticket3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1120,
        680
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "get",
        "ID": "={{ $('Get Project CMS By Client').item.json.data[0].id }}",
        "requestOptions": {}
      },
      "id": "3e28ecf2-35fc-455c-ae6b-42119f6e66a8",
      "name": "Cloodo CRM",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -1340,
        680
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "create",
        "projectName": "={{ $('Get CLient CMS By Email1').item.json.data[0].user.name }} Project",
        "start_date": "={{ $now }}",
        "user_id": "=[\"{{ $('Get CLient CMS By Email1').item.json.data[0].added_by.id }}\"]",
        "additionalFields": {
          "client_id": "=\"{{ $('Get CLient CMS By Email1').item.json.data[0].user.id }}\""
        },
        "requestOptions": {}
      },
      "id": "da14f90d-804e-4ba2-8b02-26353f43ae5a",
      "name": "Create Project2",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -4920,
        2920
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "resource": "task",
        "operation": "create",
        "heading": "=Hi {{ $json.data.members[0].name }}! Please take care project of {{ $json.data.client.user.name }}",
        "start_date": "={{ $now }}",
        "due_date": "={{ $now.plus(1, 'month') }}",
        "users": "={{ $json.data.members[0].id }}",
        "additionalFields": {
          "ProjectID": "={{ $json.data.id }}",
          "taskCategoryId": "494589d7-f5da-4aa0-823a-4f7865cde09b"
        },
        "requestOptions": {}
      },
      "id": "2375bece-1bba-4201-acc3-64d4713ec490",
      "name": "Create Task Take Care1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -4700,
        2920
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Check Client Not Tracked Before').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Get CLient CMS By Email1').item.json.data[0].user.name }},\\nIt seems that you currently don’t have any active projects in our system. To ensure we can assist you effectively and keep everything well-organized, we’ve gone ahead and created a project for you.\\nYou can access the project here: https://worksuite.cloodo.com/apps/work/project/{{ $('Create Project2').item.json.data.id }}/\\nFeel free to check it out and let us know if there’s anything specific you’d like to add. We’re here to help with whatever you need!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6e7fc44f-6fb9-4d1c-9ca6-a838ae45e62a",
      "name": "Require Project",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4480,
        2920
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "a858258c-1aae-4b28-be3c-755330d31671",
      "name": "UP Level 2 - created_project",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -7500,
        2600
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Check Client Not Tracked Before').item.json.id }}",
            "level": "2",
            "status": "created_project",
            "admin": "112710510078308",
            "project_name_support": "={{ $('Create Project2').item.json.data.name }}",
            "id_project_support": "={{ $('Create Project2').item.json.data.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "edf9d926-3ca7-4f25-86a5-8b26818e3578",
      "name": "UP Level  2 create project1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4260,
        2920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "mode": "chooseBranch",
        "output": "empty"
      },
      "id": "2592cbfb-b822-4d6b-86b1-167ab4d42d9c",
      "name": "Merge4",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -1580,
        680
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Aggregate8').item.json.data[0].from.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "97672476-5ec1-4e91-80be-0387d056e5e6",
      "name": "send issue",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -920,
        680
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_hXKJctyZjDaAYbui721cTMvi",
          "mode": "list",
          "cachedResultName": "Printcart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=Analyze the following conversation messages between the client and admin. Focus on the most recent messages sent by the client, especially the last one, to determine the client's intent and construct a JSON object based on the following format. Remember to always only analyze the customer's requests mentioned in the message without asking again or asking for more information. And let the customer know that we have received the customer's request and created a ticket to help with that request, encourage the customer to follow the ticket we have created and if there is any problem that needs help with the customer's problem, please comment on that ticket or send an email or chat with me.\n\n{\n  \"subject\": \"\",\n  \"message\": \"\"\n}\n\nInstructions:  \n1. Subject: is the title of the issue the customer is needing support for\n2. Message: is detailed information about the issue the customer is needing support for.  Since this message is read by the customer, write it formally with Dear to client and sign with Best regards, Admin Printcart\n3. Ensure the JSON is correctly formatted, valid, and accurately reflects the client’s most recent intent.  \n4. Do not include any explanation, only return the JSON object in the exact specified format.\n5. Remember to always only analyze the customer's requests mentioned in the message without asking again or asking for more information. And let the customer know that we have received the customer's request and created a ticket to help with that request, encourage the customer to follow the ticket we have created and if there is any problem that needs help with the customer's problem, please comment on that ticket or send an email or chat with me.\n\nYou are a project assistant whom responsible for creating client-facing tickets based on provided chat or email content. When provided with a client’s message, generate a well-structured and professional ticket. The ticket must include the following sections:\n\n1. Client Name: Dear {{ $('Aggregate8').item.json.data[0].from.name }}\n3. Summary of Request: A concise overview of what the client is asking for, written in a client-friendly tone.\n4. Proposed Next Steps: Clearly outline what actions will be taken by the team and any required input from the client.\n5. Action Items: Break down actionable tasks for the internal team and the client.\n6. Communication Channels: Include clear instructions for the client on how to contact David Nguyen (CEO of NetbaseJSC) for further assistance.\nUse this format:\n\nTicket: is the title of the issue the customer is needing support for\n\nClient Name:  {{ $('Aggregate8').item.json.data[0].from.name }}\n\nSummary of Request\n[Summarize the client’s request in a professional and client-friendly tone.]\n\nProposed Next Steps\n[List the steps the team will take to address the request, as well as any input required from the client.]\n\nAction Items\nFor Our Team:\n[List specific tasks for the team to complete.]\nFor You:\n[List any actions required from the client, if applicable.]\nCommunication Channels\n - contact with agent take care client ticket\n - email: support@cmsmart.net \n\nMake sure the ticket is clear, actionable, and formatted for both internal use and client review. Use professional and concise language throughout.\n\n\nBase on summary problem provided and History chat messages, let create an object with subject anb message.\n\nHere are the history conversation messages:  \n\n1. The request of client: \n{{ $('Get All Messages4').item.json.messagesSent }}\n\n\nALWAYS respond only with the correctly formatted JSON object.  ",
        "options": {}
      },
      "id": "c4c237c0-3da2-431f-a841-6479769d0ae9",
      "name": "OpenAI5",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -2600,
        780
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ALWAYS use plain text and simple bullet points if need for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.\n\nAct as LiveChat AI Assistant \n\nUse the data i provide dynamically below in a way that helps analyze the client's needs and deliver personalized responses, but without directly repeating the data back to the client. You must leverage the information you've supplied to inform its conversation flow and provide insightful, helpful responses based on the client's context.\n\nInformation about client project\nProject name: {{ $json.project.name }}\nProject status: {{ $json.project.status }}\nStart date: {{ $json.project.start_date }}\nDeadline: {{ $json.project.deadline }}\nProject members: {{ $json.project.members.map(item=> item.name) }}\n\nInformation about client:\nName: {{ $json.client.name }}\nEmail: {{ $json.client.email }}\nMobile: {{ $json.client.mobile }}\n\n\nHistory chat messages:\n{{ $json.messagesSent }}\n\n\nAI Assistant Prompt with Contextual Analysis:\nGreeting the Client:\n\n\"Hello! 👋 Welcome to [Company Name]. I’m [Your AI Assistant Name], and I’m here to assist you today. How can I help you?\"\n\n(If the client hasn’t initiated the conversation yet, this greeting will prompt them to describe their needs or project.)\n\n1. If the Client Wants to Create a New Project:\nLet call to create_new_project tools\n\n2. If the Client Needs Support with a Ticket:\nLet call to resolve_problem_ticket tools\n\n3. If the Client Asks About Their Project Information (Milestones, Status, Tasks):\nLet call to ask_info_project tools\n\n4. If the Client Wants to Add a New Feature:\nLet call to take_care_client tools\n\n5. If the Client Requests a Refund or invoice:\nLet call to take_care_client tools\n\n6. Handling Last Message from Client:\nBased on your most recent message, I can see that you’re asking about [issue or request]. Let’s address that right away!\n\nFor example, if the client’s last message is about needing help with a project feature or milestone, the AI would respond:\n\n\"I noticed you're asking about [Milestone X]. Let me help you with that! Could you confirm if you're looking for updates on this milestone or if you need assistance with a specific task related to it?\"\n\n8. Wrapping Up the Chat:\n\"Thank you for sharing all of this information with me! I’ll make sure everything is updated and will send you an email confirmation shortly.\n\nIs there anything else I can assist you with while we’re still chatting?\"\n\n9. Closing the Chat:\nLet call to summary_chat_session tools\n\n\nHow the AI Uses Your Data Dynamically:\nHistory Chat Messages:\n\nThe AI reviews the client’s past messages and uses them to tailor the conversation. For example, if the client mentioned a problem earlier, the AI might start by asking if the issue has been resolved or needs further assistance.\nClient Project Information:\n\nThe AI will dynamically access the project’s name, status, and milestones (e.g., “Your project [Project Name] is currently in [Current Status] and includes milestones like [Milestone 1, Milestone 2]”). This contextualizes the conversation, allowing the AI to give specific advice or updates based on the project’s current phase.\nClient’s Last Message:\n\nThe AI will analyze the last message from the client and build the conversation around it, ensuring that it stays relevant to their current needs (e.g., \"I see you're asking about [specific feature or issue], let me help you with that!\").\n\nFinal Notes:\nStart with a friendly greeting whenever a new conversation begins.\nAsk for relevant details based on what the client needs (creating a project, ticket support, project information, new features, or refunds).\nUse the project information you provide dynamically to craft responses, ensuring that you don’t repeat the data back verbatim but use it to inform the conversation.\n\nALWAYS use plain text with simple bullet points for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.",
        "options": {}
      },
      "id": "0883e82e-e592-476b-a9c7-b961f9ecc5aa",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1860,
        1580
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_hXKJctyZjDaAYbui721cTMvi",
          "mode": "list",
          "cachedResultName": "Printcart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=ALWAYS use plain text and simple bullet points if need for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.\n\nAct as LiveChat AI Assistant \n\nUse the data i provide dynamically below in a way that helps analyze the client's needs and deliver personalized responses, but without directly repeating the data back to the client. You must leverage the information you've supplied to inform its conversation flow and provide insightful, helpful responses based on the client's context.\n\nInformation about client project\nProject name: {{ $('Edit Fields').item.json.project.name }}\nProject status: {{ $('Edit Fields').item.json.project.status }}\nStart date: {{ $('Edit Fields').item.json.project.start_date }}\nDeadline: {{ $('Edit Fields').item.json.project.deadline }}\nProject members: {{ $('Edit Fields').item.json.project.members.map(item=> item.name) }}\n\nInformation about client:\nName: {{ $('Edit Fields').item.json.client.name }}\nEmail: {{ $('Edit Fields').item.json.client.email }}\nMobile: {{ $('Edit Fields').item.json.client.mobile }}\n\n\nHistory chat messages:\n{{ $('Edit Fields').item.json.messagesSent }}\n\nLet make the answer for client question. Focus on last message sent bny client to make best answer for client\n\n\nFinal Notes:\nStart with a friendly greeting whenever a new conversation begins.\nAsk for relevant details based on what the client needs (creating a project, ticket support, project information, new features, or refunds).\nUse the project information you provide dynamically to craft responses, ensuring that you don’t repeat the data back verbatim but use it to inform the conversation.\n\nALWAYS use plain text with simple bullet points for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.",
        "options": {}
      },
      "id": "af5cb40c-3839-4f9b-8370-5b4e1ab93683",
      "name": "OpenAI6",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -940,
        1540
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {},
      "id": "737e7351-adae-465c-ab16-a6663c1e6ecc",
      "name": "No Operation, do nothing2",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -100,
        2180
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_hXKJctyZjDaAYbui721cTMvi",
          "mode": "list",
          "cachedResultName": "Printcart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=You are a customer request analyst and an administrator named Princart is talking to a customer in a friendly manner. The customer has given a request in the message below and the problem is not clear, analyze it according to the following requirements:\n- Analyze the customer's problem\n- Restate the customer's problem\n- Ask the customer to provide more missing information\nThen combine the above ideas and reply to the customer with a short message combining the above ideas in a friendly manner.\nHere is the message information you need to analyze to send a message to the customer:\n{{ $('Get All Messages4').item.json.messagesSent }}",
        "options": {}
      },
      "id": "03b4bd0a-ab03-4dfb-b95c-245d32082fff",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -2540,
        1220
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "problem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "587ec149-5360-42e4-975c-a4f1210d55f7",
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "welcome",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "welcome"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9dcadeba-3b70-4df1-bd15-804112cfaf26",
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "unclear problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "unclear problem"
            }
          ]
        },
        "options": {}
      },
      "id": "854c4bb4-9d25-4d5e-911c-5bb4b6fb8a43",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2720,
        1020
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a customer request analyst. The customer makes a request in the message below, analyzes and concludes \"welcome\" or \"problem\" or \"unclear problem\" based on the problems the customer mentions needing support. If in the chat, the customer only states the problem and does not explain further, then the conclusion is \"unclear problem\". If in the chat, the customer only sends a greeting, then the conclusion is \"welcome\", but if the customer states the problem and explains the problem, then the conclusion is \"problem\". For example, if in the chat, the customer says: \"Hi, I just had a problem setting up the website... after installing and trying to edit or do anything, I keep getting a 503 error\" then the conclusion is \"problem\" because the customer explains that \"after installing and trying to edit or do anything, I keep getting a 503 error\"; If in the chat the customer says \"Hello, I want a refund\" then the conclusion is \"welcome\"; If in the chat the customer talks about an unclear issue then the conclusion is \"unclear issue\"\n\nJust return \"issue\" or \"welcome\" or \"unclear issue\" without explaining and adding any words.\nHere is the message information you need to analyze to come to a conclusion:\n{{ $json.messagesSent }}\n",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "bf69d9e7-e1aa-4da8-bcb3-fe4ba28f0931",
      "name": "OpenAI3",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -3080,
        1020
      ],
      "credentials": {
        "openAiApi": {
          "id": "GZJrY3xS0XEQZV7H",
          "name": "OpenAi account 5"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/112710510078308/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAAQEYCcZCVQ0BOzY6wqcnJVxVynZBLbm5hhScnbluyUZAfGFji6VNyf3R8Jvy0zDoypmZBIsFhZCU1tBRPjlIwS1FWFDeDSqzSa2AGdyDqbTN7MP88cbSiP9CPXY1gmM4EJzHWsO64oZBZA8bimm01LQ3p0n5jCpZCzhjlESwV0JGm16ocyrZBLHu9FSh5wYe08wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Switch Quantity Project2').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Get CLient CMS By Email1').item.json.data[0].user.name }},\\nI see you’ve got a lot of awesome projects happening right now! Here’s what I’ve got on my list: \\n{{ $json.listProject.map(item => `- ${item.name}`).join('\\\\n') }} \\n I’m super excited to help out with whichever one you need support on! Just let me know which one you’d like me to dive into first, and I’ll be all in to make sure everything goes smoothly. 😊 \\nCan’t wait to get started and help you out with whatever you need!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "d2083370-f65d-4dc1-a7b9-1eda180c85cd",
      "name": "send message4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2900,
        2180
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "project_list_id",
        "options": {}
      },
      "id": "ce5aa0af-58d2-486a-a272-1ad1826ab808",
      "name": "Split Out4",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1640,
        2720
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "get",
        "ID": "={{ $json.project_list_id }}",
        "requestOptions": {}
      },
      "id": "31de6481-1d2e-4508-9850-10de0f66e38e",
      "name": "Get list project",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -1440,
        2720
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let result = [];\n\n// Lặp qua tất cả các phần tử trong Switch2\nfor (const item of $('Switch2').all()) {\n  // Kiểm tra nếu item.json có tồn tại và là đối tượng hợp lệ\n  if (item.json && typeof item.json === 'object' && item.json !== null) {\n    console.log('Valid json object:', item.json); // Log ra json hợp lệ\n\n    // Kiểm tra nếu list_id_project có tồn tại và là chuỗi\n    if (typeof item.json.list_id_project === 'string') {\n      try {\n        // Chuyển chuỗi thành mảng\n        const list = JSON.parse(item.json.list_id_project);\n\n        // Lặp qua các giá trị trong mảng list_id_project và thêm từng phần tử vào kết quả\n        for (const i of list) {\n          result.push(i); // Thêm phần tử vào mảng kết quả\n        }\n      } catch (error) {\n        console.error('Error parsing list_id_project:', error);\n      }\n    } else {\n      console.log('list_id_project is not a string or is missing:', item.json);\n    }\n\n    // Thêm cột 'results' vào item\n    item.json.project_list_id = result; // Gán mảng 'result' vào cột 'results' trong item\n  } else {\n    // Log ra nếu json không hợp lệ\n    console.log('Invalid json or json is null:', item);\n  }\n}\n\nconsole.log('Updated Items:', $('Switch2').all()); // Hiển thị dữ liệu sau khi thêm cột 'results'\n\n// Trả về dữ liệu đã được thêm cột 'results'\nreturn $('Switch2').all(); \n"
      },
      "id": "92d6e776-3b63-48b9-b00c-da6025f356ae",
      "name": "Code get list pro",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1860,
        2720
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "df7906b4-0e60-4f3e-afd0-cf3344fc54e1",
      "name": "Aggregate9",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1220,
        2720
      ]
    },
    {
      "parameters": {
        "jsCode": "return {\n\n    \"index\": 0,\n    \"message\": {\n      \"role\": \"assistant\",\n      \"content\": \"Nguyễn Đức Cảnh Project\",\n      \"refusal\": null\n    },\n    \"logprobs\": null,\n    \"finish_reason\": \"stop\"\n}"
      },
      "id": "f520e84d-d3cb-4ae6-8acd-f64cbca87254",
      "name": "Code9",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1020,
        2900
      ]
    },
    {
      "parameters": {
        "amount": 10
      },
      "id": "f00d0d2e-ee9e-4b9f-a97c-79c7abc073c7",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -7680,
        620
      ],
      "webhookId": "bcb53c9d-04ed-436e-a2c8-6e09fc7991dd"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a customer request analyst. The customer makes a request in the message below, analyzes and concludes \"problem\" or \"email\" based on the content that the customer mentions needing support.\n\nIf in the conversation, the customer only states the problem and does not explain further or the customer explains, then the conclusion is \"problem\"\nIf in the conversation, in the most recent message, the customer sends information including email, then the conclusion is \"email\". For example, if in the conversation, the customer talks about the problem of anything that does not have email in it, then the conclusion is \"problem\"; If in the conversation, the customer talks about information including email, then the conclusion is \"email\".\n\nJust conclude \"problem\" or \"email\" without further explanation.\nHere is the message information you need to analyze to draw conclusions:\n{{ $json.messagesSent }}\n",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "bb624623-e18b-4734-be73-54eb67879b33",
      "name": "OpenAI4",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -4140,
        -60
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_hXKJctyZjDaAYbui721cTMvi",
          "mode": "list",
          "cachedResultName": "Printcart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=You are a customer request analyst and an administrator named PrintCartPOD is talking to a customer in a friendly manner. The customer has given a request in the message below and you do not have the customer's email, analyze it according to the following requirements:\n- Analyze the customer's problem\n- Restate the customer's problem\n- Ask the customer to provide additional missing information\n- Most importantly, get the customer's email\nThen send a friendly message starting with Hello and ending with Best Regard, Printcart\nHere is the message information you need to analyze to send a message to the customer:\n{{ $('Get All Messages3').item.json.messagesSent }}",
        "options": {}
      },
      "id": "afb32e10-9ea6-48bd-9a05-0221a4241cc8",
      "name": "OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        -3580,
        -380
      ],
      "credentials": {
        "openAiApi": {
          "id": "NFeGqVn7YLHPSlQH",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "project_list_id",
        "options": {}
      },
      "id": "6dd05e7f-8d58-4189-9a52-3872a8976911",
      "name": "Split Out5",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -3820,
        2340
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "get",
        "ID": "={{ $json.project_list_id }}",
        "requestOptions": {}
      },
      "id": "da1eedce-5df0-4a89-9262-e6b234c95219",
      "name": "Get list project1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        -3620,
        2340
      ],
      "credentials": {
        "cloodoApi": {
          "id": "9ceDNPpBEBMqKFjc",
          "name": "Workflow Princart"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let result = [];\n\n// Lặp qua tất cả các phần tử trong Switch2\nfor (const item of $('Switch2').all()) {\n  // Kiểm tra nếu item.json có tồn tại và là đối tượng hợp lệ\n  if (item.json && typeof item.json === 'object' && item.json !== null) {\n    console.log('Valid json object:', item.json); // Log ra json hợp lệ\n\n    // Kiểm tra nếu list_id_project có tồn tại và là chuỗi\n    if (typeof item.json.list_id_project === 'string') {\n      try {\n        // Chuyển chuỗi thành mảng\n        const list = JSON.parse(item.json.list_id_project);\n\n        // Lặp qua các giá trị trong mảng list_id_project và thêm từng phần tử vào kết quả\n        for (const i of list) {\n          result.push(i); // Thêm phần tử vào mảng kết quả\n        }\n      } catch (error) {\n        console.error('Error parsing list_id_project:', error);\n      }\n    } else {\n      console.log('list_id_project is not a string or is missing:', item.json);\n    }\n\n    // Thêm cột 'results' vào item\n    item.json.project_list_id = result; // Gán mảng 'result' vào cột 'results' trong item\n  } else {\n    // Log ra nếu json không hợp lệ\n    console.log('Invalid json or json is null:', item);\n  }\n}\n\nconsole.log('Updated Items:', $('Switch2').all()); // Hiển thị dữ liệu sau khi thêm cột 'results'\n\n// Trả về dữ liệu đã được thêm cột 'results'\nreturn $('Switch2').all(); \n"
      },
      "id": "164e78ce-a3dd-4df0-9627-4fc40aca996e",
      "name": "Code get list pro1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4040,
        2340
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "5a9b778c-aaf5-43db-9711-592f5dde8d21",
      "name": "Aggregate10",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -3400,
        2340
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "status": "ask_project",
            "level": "3",
            "list_id_project": "={{ $('Get Project CMS By Client').item.json.data.map(item=>item.id) }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "8b52032e-852f-49db-a83f-f4d2371427a5",
      "name": "UP Level 3 - ask_project2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4800,
        2520
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "22707f99-f89a-458f-8ee6-c5aa25d4cdf6",
      "name": "Get Tracked3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -4560,
        2520
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Vl0s1SHrC6Hdk8iv",
          "name": "Canh Google Sheets "
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Tracked3').item.json.list_id_project }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not_comfirm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bd6d7b3a-906e-4c37-8d1d-2297746652b3",
                    "leftValue": "={{ $('Get Tracked3').item.json.list_id_project }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirm"
            }
          ]
        },
        "options": {}
      },
      "id": "64d2e9e7-be04-4f8c-8748-4eda95dac274",
      "name": "Switch2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -4340,
        2520
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length === 1 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "One Project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c0d9bf88-52c2-4ab4-9f75-8e77387bfb33",
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length > 1 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Many Project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cf3c7e3a-eb06-4ab9-8fa5-788bedc0243d",
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length === 0 }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Non-Project"
            }
          ]
        },
        "options": {}
      },
      "id": "5918b845-2a93-49a7-ab73-71ddae7033a3",
      "name": "Switch Quantity Project2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -5140,
        2520
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Get Detail list Chat User2": {
      "main": [
        [
          {
            "node": "Get Detail Last list Chat User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Client Tracked Before": {
      "main": [
        [
          {
            "node": "UP Level 1 - open",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check mail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked": {
      "main": [
        [
          {
            "node": "Check Client Tracked Before",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 1 - open": {
      "main": [
        [
          {
            "node": "send reply client new",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check mail": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "send client no email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take mail": {
      "main": [
        [
          {
            "node": "mail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Client By Email": {
      "main": [
        [
          {
            "node": "check mail client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message3": {
      "main": [
        [
          {
            "node": "UP Level  2 account",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check mail client": {
      "main": [
        [
          {
            "node": "Update contact client1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client": {
      "main": [
        [
          {
            "node": "send message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked1": {
      "main": [
        [
          {
            "node": "Check mail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check mail1": {
      "main": [
        [
          {
            "node": "Get Id Store2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get CLient CMS By Email1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Project By Client": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Project": {
      "main": [
        [
          {
            "node": "Create Task Take Care",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Task Take Care": {
      "main": [
        [
          {
            "node": "send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message": {
      "main": [
        [
          {
            "node": "UP Level  2 create project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Update contact client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User3": {
      "main": [
        [
          {
            "node": "Take Page Next",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Id Store": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF6": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take Page Next": {
      "main": [
        [
          {
            "node": "IF6",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Save messaage1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages": {
      "main": [
        [
          {
            "node": "Cloodo Milestone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get messages according to id": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Get All Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Save messaage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage1": {
      "main": [
        [
          {
            "node": "Get messages according to id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cloodo Milestone": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "create_new_project": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "resolve_problem_ticket": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ask_info_project": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "take_care_client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "summary_chat_session": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User4": {
      "main": [
        [
          {
            "node": "Last send by Client1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "send message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Get Client By Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client1": {
      "main": [
        [
          {
            "node": "Get Project By Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages1": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI2": {
      "main": [
        [
          {
            "node": "Get Project support",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 3 - confirm_project1": {
      "main": [
        [
          {
            "node": "Delete message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Project support": {
      "main": [
        [
          {
            "node": "send message5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "send message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Get All Messages1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User5": {
      "main": [
        [
          {
            "node": "Take Page Next1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Id Store1": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take Page Next1": {
      "main": [
        [
          {
            "node": "IF",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Aggregate3": {
      "main": [
        [
          {
            "node": "Save messaage4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages2": {
      "main": [
        [
          {
            "node": "Code get list pro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get messages according to id1": {
      "main": [
        [
          {
            "node": "Aggregate4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate4": {
      "main": [
        [
          {
            "node": "Get All Messages2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage3": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out3": {
      "main": [
        [
          {
            "node": "Save messaage3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Aggregate3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage4": {
      "main": [
        [
          {
            "node": "Get messages according to id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message5": {
      "main": [
        [
          {
            "node": "UP Level 3 - confirm_project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many list chat": {
      "main": [
        [
          {
            "node": "Item Lists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item Lists": {
      "main": [
        [
          {
            "node": "Get Id User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Id User": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User": {
      "main": [
        [
          {
            "node": "Last send by Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Function",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [],
        [],
        [
          {
            "node": "Create Project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail Last list Chat User": {
      "main": [
        [
          {
            "node": "Last send by client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last send by client": {
      "main": [
        [
          {
            "node": "Get Tracked1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User6": {
      "main": [
        [
          {
            "node": "Take Page Next2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Id Store2": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF7": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take Page Next2": {
      "main": [
        [
          {
            "node": "IF7",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Aggregate5": {
      "main": [
        [
          {
            "node": "Save messaage5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get messages according to id2": {
      "main": [
        [
          {
            "node": "Aggregate6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate6": {
      "main": [
        [
          {
            "node": "Get All Messages3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage2": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Save messaage2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Aggregate5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage5": {
      "main": [
        [
          {
            "node": "Get messages according to id2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages3": {
      "main": [
        [
          {
            "node": "OpenAI4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome": {
      "main": [
        [
          {
            "node": "UP Level 1 - open1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory3": {
      "ai_memory": [
        [
          {
            "node": "OpenAI5",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "send welcome1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Take mail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code8": {
      "main": [
        [
          {
            "node": "send welcome2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mail": {
      "main": [
        [
          {
            "node": "Get CLient CMS By Email",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "remind mail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get CLient CMS By Email": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cloodo CRM Create New Client": {
      "main": [
        [
          {
            "node": "Create Project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Project1": {
      "main": [
        [
          {
            "node": "Update contact client2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Cloodo CRM Create New Client",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update contact client3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client2": {
      "main": [
        [
          {
            "node": "send create account",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "remind mail": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome2": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send create account": {
      "main": [
        [
          {
            "node": "Append1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing1": {
      "main": [
        [
          {
            "node": "Delete message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Project CMS By Client": {
      "main": [
        [
          {
            "node": "Get Tracked2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked2": {
      "main": [
        [
          {
            "node": "Check Client Not Tracked Before",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Client Not Tracked Before": {
      "main": [
        [
          {
            "node": "Switch Quantity Project2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client3": {
      "main": [
        [
          {
            "node": "send received email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send received email": {
      "main": [
        [
          {
            "node": "Append3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get CLient CMS By Email1": {
      "main": [
        [
          {
            "node": "Get Project CMS By Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User7": {
      "main": [
        [
          {
            "node": "Take Page Next3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Id Store3": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF8": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take Page Next3": {
      "main": [
        [
          {
            "node": "IF8",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Aggregate7": {
      "main": [
        [
          {
            "node": "Save messaage7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get messages according to id3": {
      "main": [
        [
          {
            "node": "Aggregate8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate8": {
      "main": [
        [
          {
            "node": "Get All Messages4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage6": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Save messaage6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save messaage7": {
      "main": [
        [
          {
            "node": "Get messages according to id3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Aggregate7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages4": {
      "main": [
        [
          {
            "node": "OpenAI3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "Delete message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 1 - open1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Ticket3": {
      "main": [
        [
          {
            "node": "send issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cloodo CRM": {
      "main": [
        [
          {
            "node": "Create Ticket3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Info Issue1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Project2": {
      "main": [
        [
          {
            "node": "Create Task Take Care1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Task Take Care1": {
      "main": [
        [
          {
            "node": "Require Project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Require Project": {
      "main": [
        [
          {
            "node": "UP Level  2 create project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Cloodo CRM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last send by Client1": {
      "main": [
        [
          {
            "node": "OpenAI6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI5": {
      "main": [
        [
          {
            "node": "Get Info Issue1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI6": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message2": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing2": {
      "main": [
        [
          {
            "node": "Delete message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "OpenAI5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "send welcome",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI3": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message4": {
      "main": [
        [
          {
            "node": "UP Level 3 - ask_project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out4": {
      "main": [
        [
          {
            "node": "Get list project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code get list pro": {
      "main": [
        [
          {
            "node": "Split Out4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get list project": {
      "main": [
        [
          {
            "node": "Aggregate9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate9": {
      "main": [
        [
          {
            "node": "OpenAI2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI4": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "Code8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out5": {
      "main": [
        [
          {
            "node": "Get list project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get list project1": {
      "main": [
        [
          {
            "node": "Aggregate10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code get list pro1": {
      "main": [
        [
          {
            "node": "Split Out5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 3 - ask_project2": {
      "main": [
        [
          {
            "node": "Get Tracked3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked3": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Code get list pro1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Id Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Quantity Project2": {
      "main": [
        [
          {
            "node": "Get Id Store",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "UP Level 3 - ask_project2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Project2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "43e35876-af3c-4b06-a5c0-ce1a406ca720",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3909475c03ca6926b6e6edc6a6f06c1feb448ce7ac700d69b17002085d9011f8"
  },
  "id": "4U0MYdkQXyKV45RF",
  "tags": []
}