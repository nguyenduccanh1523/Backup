{
  "name": "AI Agent Facebook Messager",
  "nodes": [
    {
      "parameters": {},
      "id": "3bca360a-e1ae-4cdf-ba1b-b901c7760525",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        420,
        -2020
      ]
    },
    {
      "parameters": {
        "content": "## Chia ticket cho Phương, Chi, Huy"
      },
      "id": "eb083aed-860c-491e-9749-6c19b910315e",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1600,
        4620
      ]
    },
    {
      "parameters": {
        "functionCode": "return items;"
      },
      "name": "Function",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        540,
        -1760
      ],
      "id": "1439f0e6-5b3c-4755-a9e2-f5479a3ce32c"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.messages.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "id,message,from,to,created_time"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "5b799cbb-010e-4b89-89ab-aac5d9b5568d",
      "name": "Get Detail Last list Chat User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1600,
        -1760
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a4bb989a-d243-4888-87d3-773e405fa336",
              "leftValue": "={{ $json.from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "264909f4-3c00-4597-af3f-e4ba4208da7d",
              "leftValue": "={{ new Date($json.created_time.replace(' ', 'T').replace('+0000', '+07:00')).getTime() }}",
              "rightValue": "={{ new Date(Date.now() - 0.4 * 60 * 1000).getTime() }}",
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f3e0edeb-d09a-4a4f-bd99-57497ecff684",
      "name": "Last send by client",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1800,
        -1760
      ]
    },
    {
      "parameters": {
        "jsCode": "return{\n\n\n\n  \n    \"headers\": {\n      \"host\": \"workflow.cloodo.com\",\n      \"user-agent\": \"axios/1.7.9\",\n      \"content-length\": \"82\",\n      \"accept\": \"application/json, text/plain, */*\",\n      \"accept-encoding\": \"gzip, compress, deflate, br\",\n      \"content-type\": \"application/json\",\n      \"x-forwarded-for\": \"207.244.255.94\",\n      \"x-forwarded-host\": \"workflow.cloodo.com\",\n      \"x-forwarded-port\": \"443\",\n      \"x-forwarded-proto\": \"https\",\n      \"x-forwarded-server\": \"40c48caec682\",\n      \"x-real-ip\": \"207.244.255.94\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": {\n      \"senderId\": \"9328599640527653\",\n      \"message\": \"i need know my project\",\n      \"imageUrl\": null\n    },\n    \"webhookUrl\": \"https://workflow.cloodo.com/webhook/SJ2Az23OeQTAADDE/webhook/facebook\",\n    \"executionMode\": \"production\"\n\n\n\n\n\n\n}"
      },
      "id": "d6ec3343-460d-4f44-a839-2d9146caf24c",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        640,
        -2020
      ]
    },
    {
      "parameters": {
        "content": "## {{ $json.body.senderId }}\n",
        "width": 318.78827753313925
      },
      "id": "be9dfa19-348a-48e2-ba25-6825b9c74d57",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        920,
        -2020
      ]
    },
    {
      "parameters": {
        "amount": 10
      },
      "id": "eb8248b2-903d-4e95-a914-116691927115",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        760,
        -1760
      ],
      "webhookId": "bcb53c9d-04ed-436e-a2c8-6e09fc7991dd",
      "disabled": true
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "41a0a7b0-cf4b-449d-bda9-1489a4be20cc",
      "name": "Get Detail list Chat User6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1180,
        -1760
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "4f6818d1-d8cf-4231-8b54-293cef3060c2",
      "name": "Get Tracked2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        2020,
        -1780
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e728f992-d3a6-498a-adf0-c5799f54f052",
              "leftValue": "={{ $json.email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "44f266ef-ac8d-4c4b-af7a-ba0a2b8f0a33",
      "name": "Check mail2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2220,
        -1780
      ]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v21.0/213439902114044/conversations",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "MESSENGER"
            },
            {
              "name": "user_id",
              "value": "={{ $json.body.senderId }}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "4c4bfdaf-898f-4363-b56e-f47d7a166a81",
      "name": "HTTP Request5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        980,
        -1760
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI1']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "36d3112c-84d2-4fa0-9a98-28e0ab0fd8c9",
      "name": "Code8",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4360,
        -2540
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $json.email.replaceAll(/@facebook.com/g, '') }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $('Code8').item.json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "c7abf3e9-e813-40dc-8030-fcd7def9e055",
      "name": "send welcome2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4820,
        -2540
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Dear {{ $json.participants.data[0].name }},\\nI’m reaching out regarding the email address you provided. Unfortunately, it appears that the email is incomplete or missing. Could you kindly provide the correct email address at your earliest convenience? This will help us proceed with your request smoothly.\\n Thank you for your understanding and cooperation. Please let me know if you need any assistance with this.\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "9141c34d-8354-42af-992e-38ccf2c8ef8e",
      "name": "remind mail",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4960,
        -1880
      ]
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "getmany",
        "page": "=1",
        "additionalFields": {
          "searchLead": "={{ $('Take mail1').item.json.Email }}"
        },
        "requestOptions": {}
      },
      "id": "ea154943-e1c9-451e-b824-35608e318c06",
      "name": "Get CLient CMS By Email",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        4700,
        -2240
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "create",
        "name": "={{ $('Get User Facebook').item.json.participants.data[0].name }}",
        "passwordClinet": "=qK8|*E04J}06",
        "clientEmail": "={{ $('Take mail1').item.json.Email }}",
        "additionalFields": {
          "added_by": "afd3f239-57cb-44be-80dc-b4d0b488aab3"
        },
        "requestOptions": {}
      },
      "id": "351da351-a936-472f-b5f3-b15d58097d86",
      "name": "Cloodo CRM Create New Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        5180,
        -2320
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "create",
        "projectName": "= {{ $json.data.user.name.split(\"@\")[0] }} Project",
        "start_date": "={{ $now }}",
        "user_id": "=[\"{{ $json.data.added_by.id }}\"]",
        "additionalFields": {
          "client_id": "=\"{{ $json.data.user.id }}\""
        },
        "requestOptions": {}
      },
      "id": "ed2f0531-b4e9-4f0c-870e-800487bc9564",
      "name": "Create Project1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        5380,
        -2320
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hello {{ $('Get User Facebook').item.json.participants.data[0].name }}, \\nTo provide you with the best support possible, we've created a new client account for you on our system. Please login using the email we've registered for you. For security reasons, we recommend setting a new password upon your first login. You can do this by visiting our website and following the instructions for 'Forgot Password' if needed.\\nUsername: {{ $('Take mail1').item.json.Email }} \\nPassword: qK8|*E04J}06 \\nVisit our system: https://worksuite.cloodo.com/ \\nIf you have any questions during the process, feel free to reach out for assistance.\\nThank you for working with us!\\nLet me know if there's anything else you need or if there's any other way I can assist you!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "d05ec4ef-efaa-43f6-9858-c354122a49e4",
      "name": "send create account",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5740,
        -2320
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\",\n    \"email\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $('Cloodo CRM Create New Client').item.json.data.user.id }}\"\n}",
        "options": {}
      },
      "id": "7fabefcd-a538-4e33-aadc-a32b66ed53e0",
      "name": "Update contact client2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5560,
        -2320
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {},
      "id": "1537c675-c37f-4cd5-9f27-bb46698b3290",
      "name": "No Operation, do nothing1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        6420,
        -2120
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://erp-amz.cloodo.com/v4/client-contacts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "cloodoApi",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json^",
        "body": "={\n    \"title\": \"Facebook\",\n    \"name\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\",\n    \"email\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n    \"phone\": \"\",\n    \"user_id\": \"{{ $json.data[0].user.id }}\"\n}",
        "options": {}
      },
      "id": "16ffdae0-bfb0-466e-b2f2-6c3de1a5df85",
      "name": "Update contact client3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5180,
        -2120
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Thank you for providing the details. We’ve successfully received the information you’ve provided, and everything seems to be in order.\\nIn order to assist you further, could you kindly clarify the issue you are encountering? Please provide as much detail as possible so we can resolve it efficiently.\\nWe’re here to help, and we look forward to your response.\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "a470d264-38c8-4ee1-accb-aa37f54fecd3",
      "name": "send received email",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5420,
        -2120
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "Company": "={{ $('Get User Facebook').item.json.participants.data[1].name }}",
            "client": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "client_name": "={{ $('Get User Facebook').item.json.participants.data[0].name }}",
            "level": "1",
            "status": "open",
            "email": "={{ $('Take mail1').item.json.Email }}",
            "mailFacebook": "={{ $('Get User Facebook').item.json.participants.data[0].email }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "a037441e-3147-491d-bcae-9d4d2f366267",
      "name": "Append1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        5920,
        -2320
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "Company": "={{ $('Get User Facebook').item.json.participants.data[1].name }}",
            "client": "={{ $('Get User Facebook').item.json.participants.data[0].id }}",
            "client_name": "={{ $('Get User Facebook').item.json.participants.data[0].name }}",
            "level": "1",
            "status": "open",
            "email": "={{ $('Take mail1').item.json.Email }}",
            "mailFacebook": "={{ $('Get User Facebook').item.json.participants.data[0].email }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "9a2b921f-740c-47ea-9151-b83fce467613",
      "name": "Append3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        5620,
        -2120
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "for (const item of $('Aggregate14').all()) {\n  const mail = item?.json?.data[0]?.message;\n  console.log('arg', mail);\n\n  // Biểu thức chính quy kiểm tra email\n  const emailRegex = /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}\\b/\n  const foundEmail = mail ? mail.match(emailRegex) : null;\n\n  // Nếu có email thì gán vào myNewField, không thì trả về null\n  item.json.Email = foundEmail ? foundEmail[0] : null;\n}\n\nreturn $('Aggregate14').all();"
      },
      "id": "8770a023-5a34-4a35-9868-e8d38979eb70",
      "name": "Take mail1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3920,
        -2160
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2d4dda6b-c9a9-48ef-96a2-48d021bc255f",
              "leftValue": "={{ $json.Email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "17332a80-4fdd-4169-8be0-3657258c41ee",
      "name": "mail1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4120,
        -2160
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "additionalFields": {
          "client_id": "={{ $json.data[0].user.id }}"
        },
        "requestOptions": {}
      },
      "id": "c5c224e7-1b29-4d28-862e-753a8aef1996",
      "name": "Get Project CMS By Client",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        2740,
        -1480
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9fd9da20-5532-4026-8eff-b6e09856d627",
              "leftValue": "={{ $json.client.toString() }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "7eaa7e2f-60ac-4081-9d2d-7ae0d46a759c",
      "name": "Check Client Not Tracked Before",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3020,
        -820
      ]
    },
    {
      "parameters": {
        "resource": "client",
        "operation": "getmany",
        "page": "1",
        "additionalFields": {
          "searchLead": "={{ $json.email }}"
        },
        "requestOptions": {}
      },
      "id": "af21f3f5-3e48-4190-a199-f2a464d1a2ac",
      "name": "Get CLient CMS By Email1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        2500,
        -1480
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $('Check mail2').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ce8290ce-5828-4071-befa-46fc6a8d8747",
      "name": "Get Tracked3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        2960,
        -1480
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "err"
      },
      "id": "b91f7a96-f4df-4c4f-8126-aad7663f9f3a",
      "name": "Stop and Error1",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        2440,
        -380
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Get User Facebook2').item.json.participants.data[0].name }}, thank you for reaching out. I’m here to assist you with your project needs. Could you share a bit more about what you’re looking for assistance with?\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "fe1bc3aa-d2b7-441f-b69d-cb20699c4f2f",
      "name": "send welcome",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4960,
        -1380
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 778731400,
          "mode": "list",
          "cachedResultName": "Follow CLient",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=778731400"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Aggregate8').item.json.data[0].from.id }}",
            "Company": "={{ $('Aggregate6').item.json.data[0].to.data[0].name }}",
            "client": "={{ $('Aggregate6').item.json.data[0].from.id }}",
            "client_name": "={{ $('Aggregate6').item.json.data[0].from.name }}",
            "level": "1",
            "status": "open",
            "admin": "={{ $('Aggregate6').item.json.data[0].to.data[0].id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "298093c7-14a0-45c5-bb8b-ef525853a1d4",
      "name": "UP Level 1 - open1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        5180,
        -1380
      ],
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"MESSAGE_TAG\",\n  \"tag\": \"ACCOUNT_UPDATE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "6462ba2c-d3ac-4528-9489-217cb92353d8",
      "name": "send welcome1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5460,
        -1160
      ]
    },
    {
      "parameters": {},
      "id": "fafbba9c-d7f6-4c60-8976-9d40189f9ed2",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        6400,
        -1340
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  messagerAI = messagerAI.replace(/###/g, '');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "8d7e4f39-e75e-42dd-b6c9-60c2af1c9231",
      "name": "Code9",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5220,
        -1160
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "create",
        "projectName": "={{ $('Get CLient CMS By Email1').item.json.data[0].user.name }} Project",
        "start_date": "={{ $now }}",
        "user_id": "=[\"{{ $('Get CLient CMS By Email1').item.json.data[0].added_by.id }}\"]",
        "additionalFields": {
          "client_id": "=\"{{ $('Get CLient CMS By Email1').item.json.data[0].user.id }}\""
        },
        "requestOptions": {}
      },
      "id": "4644998c-54a4-4923-badc-4b585d32ab92",
      "name": "Create Project2",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        3560,
        500
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "resource": "task",
        "operation": "create",
        "heading": "=Hi {{ $json.data.members[0].name }}! Please take care project of {{ $json.data.client.user.name }}",
        "start_date": "={{ $now }}",
        "due_date": "={{ $now.plus(1, 'month') }}",
        "users": "={{ $json.data.members[0].id }}",
        "additionalFields": {
          "ProjectID": "={{ $json.data.id }}",
          "taskCategoryId": "7608c26a-5c91-4446-8f56-ba958d139ab6"
        },
        "requestOptions": {}
      },
      "id": "a8717d46-c1cb-4350-915f-679525536b7a",
      "name": "Create Task Take Care1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        3780,
        500
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Check Client Not Tracked Before').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"Hi {{ $('Get CLient CMS By Email1').item.json.data[0].user.name }},\\nIt seems that you currently don’t have any active projects in our system. To ensure we can assist you effectively and keep everything well-organized, we’ve gone ahead and created a project for you.\\nYou can access the project here: https://worksuite.cloodo.com/apps/work/project/{{ $('Create Project2').item.json.data.id }}/\\nFeel free to check it out and let us know if there’s anything specific you’d like to add. We’re here to help with whatever you need!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "e0153196-ddc2-4d4d-85ae-1862ff6e107f",
      "name": "Require Project",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4000,
        500
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "project_name_support": "={{ $('Create Project2').item.json.data.name }}",
            "id_project_support": "={{ $('Create Project2').item.json.data.id }}",
            "status": "created_project",
            "level": "2",
            "admin": "213439902114044",
            "id": "={{ $('Check Client Not Tracked Before').item.json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "208c65a3-37d3-4ee5-974c-7c7ab92585fd",
      "name": "UP Level  2 create project1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        4220,
        500
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "get",
        "ID": "={{ $json.project_list_id }}",
        "requestOptions": {}
      },
      "id": "5b445312-35b6-4514-a172-aa0535970a4b",
      "name": "Get list project",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        5800,
        180
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let result = [];\n\n// Lặp qua tất cả các phần tử trong Switch2\nfor (const item of $('Switch6').all()) {\n  // Kiểm tra nếu item.json có tồn tại và là đối tượng hợp lệ\n  if (item.json && typeof item.json === 'object' && item.json !== null) {\n    console.log('Valid json object:', item.json); // Log ra json hợp lệ\n\n    // Kiểm tra nếu list_id_project có tồn tại và là chuỗi\n    if (typeof item.json.list_id_project === 'string') {\n      try {\n        // Chuyển chuỗi thành mảng\n        const list = JSON.parse(item.json.list_id_project);\n\n        // Lặp qua các giá trị trong mảng list_id_project và thêm từng phần tử vào kết quả\n        for (const i of list) {\n          result.push(i); // Thêm phần tử vào mảng kết quả\n        }\n      } catch (error) {\n        console.error('Error parsing list_id_project:', error);\n      }\n    } else {\n      console.log('list_id_project is not a string or is missing:', item.json);\n    }\n\n    // Thêm cột 'results' vào item\n    item.json.project_list_id = result; // Gán mảng 'result' vào cột 'results' trong item\n  } else {\n    // Log ra nếu json không hợp lệ\n    console.log('Invalid json or json is null:', item);\n  }\n}\n\nconsole.log('Updated Items:', $('Switch6').all()); // Hiển thị dữ liệu sau khi thêm cột 'results'\n\n// Trả về dữ liệu đã được thêm cột 'results'\nreturn $('Switch6').all(); \n"
      },
      "id": "00469284-d038-4d95-9075-f1fb40095ae7",
      "name": "Code get list pro",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5380,
        180
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "get",
        "ID": "={{ $json.project_list_id }}",
        "requestOptions": {}
      },
      "id": "efabd8e8-fb4f-4f12-af1a-94628ff6fa55",
      "name": "Get list project1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        4920,
        -200
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let result = [];\n\n// Lặp qua tất cả các phần tử trong Switch2\nfor (const item of $('Switch6').all()) {\n  // Kiểm tra nếu item.json có tồn tại và là đối tượng hợp lệ\n  if (item.json && typeof item.json === 'object' && item.json !== null) {\n    console.log('Valid json object:', item.json); // Log ra json hợp lệ\n\n    // Kiểm tra nếu list_id_project có tồn tại và là chuỗi\n    if (typeof item.json.list_id_project === 'string') {\n      try {\n        // Chuyển chuỗi thành mảng\n        const list = JSON.parse(item.json.list_id_project);\n\n        // Lặp qua các giá trị trong mảng list_id_project và thêm từng phần tử vào kết quả\n        for (const i of list) {\n          result.push(i); // Thêm phần tử vào mảng kết quả\n        }\n      } catch (error) {\n        console.error('Error parsing list_id_project:', error);\n      }\n    } else {\n      console.log('list_id_project is not a string or is missing:', item.json);\n    }\n\n    // Thêm cột 'results' vào item\n    item.json.project_list_id = result; // Gán mảng 'result' vào cột 'results' trong item\n  } else {\n    // Log ra nếu json không hợp lệ\n    console.log('Invalid json or json is null:', item);\n  }\n}\n\nconsole.log('Updated Items:', $('Switch6').all()); // Hiển thị dữ liệu sau khi thêm cột 'results'\n\n// Trả về dữ liệu đã được thêm cột 'results'\nreturn $('Switch6').all(); \n"
      },
      "id": "f7da6b47-fbf8-46f8-aac5-488a1112d855",
      "name": "Code get list pro1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4500,
        -200
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "list_id_project": "={{ $('Get Project CMS By Client').item.json.data.map(item=>item.id) }}",
            "status": "ask_project",
            "level": "3",
            "id": "={{ $json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "1459f23f-dea3-402e-beb2-3cfa0a85eb39",
      "name": "UP Level 3 - ask_project2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        3740,
        -80
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length === 1 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "One Project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c0d9bf88-52c2-4ab4-9f75-8e77387bfb33",
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length > 1 }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Many Project"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cf3c7e3a-eb06-4ab9-8fa5-788bedc0243d",
                    "leftValue": "={{ $('Get Project CMS By Client').item.json.data.length === 0 }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Non-Project"
            }
          ]
        },
        "options": {}
      },
      "id": "10951c9c-4242-457f-9e1c-3cdd64949c0d",
      "name": "Switch Quantity Project2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3360,
        -260
      ]
    },
    {
      "parameters": {
        "resource": "chat",
        "chatModel": "gpt-4o",
        "prompt": {
          "messages": [
            {
              "role": "assistant",
              "content": "=Given the list of project names provided below and the conversation messages between the client and admin, determine which project the client needs support with. Please follow these steps:\n\nReview the Project List and Conversation Messages provided below.\nFollow the chronological sequence of messages based on the \"Time Send\" timestamps.\nIf the client directly mentions a project (even partially), return only exactly the name of project follow list name project below.\nIf the client does not directly mention any project or the project cannot be identified from the conversation, return 'notfound'.\n\nProject List: {{ $('Aggregate11').item.json.data.map(item => `${item.name}`).join('\\n') }}\n\nConversation Messages: {{ $('Get All Messages5').item.json.messagesSent }}\n"
            }
          ]
        },
        "simplifyOutput": "=true",
        "options": {
          "maxTokens": 1600
        },
        "requestOptions": {}
      },
      "id": "213c7422-53b7-40fe-b6ec-e4d530c01692",
      "name": "OpenAI6",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1.1,
      "position": [
        6020,
        180
      ],
      "credentials": {
        "openAiApi": {
          "id": "wXCGwiut9MvtTGmk",
          "name": "Workflow API"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Switch6').item.json.id }}",
            "level": "3",
            "status": "confirm_project",
            "id_project_support": "={{ $('Get Project support1').item.json.projectFound[0].id }}",
            "project_name_support": "={{ $('Get Project support1').item.json.projectFound[0].name }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "admin",
              "displayName": "admin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Company",
              "displayName": "Company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client",
              "displayName": "client",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_session",
              "displayName": "start_session",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_project_support",
              "displayName": "id_project_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "project_name_support",
              "displayName": "project_name_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_ticket_support",
              "displayName": "id_ticket_support",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "list_id_project",
              "displayName": "list_id_project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name_project_create",
              "displayName": "name_project_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_summary_create",
              "displayName": "project_summary_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start_date_create",
              "displayName": "start_date_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "deadline_create",
              "displayName": "deadline_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "project_url_create",
              "displayName": "project_url_create",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mailFacebook",
              "displayName": "mailFacebook",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {
          "useAppend": true
        }
      },
      "id": "88c3d6b3-17ef-4405-a3f7-89f8ee52841d",
      "name": "UP Level 3 - confirm_project",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        6680,
        180
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let project =[]\nconst nameProjectFind = $input.all()[0].json.message.content.trim()\nfor (const item of $('Aggregate11').all()[0]?.json?.data) {\n  if(nameProjectFind == item?.name){\n     let projectItem ={\n    id: item?.id,\n    name: item?.name\n  }\n  project.push(projectItem)\n    break\n  }\n \n}\n\nreturn {projectFound: project};"
      },
      "id": "ff4f31f4-7467-4830-b4af-3a28e4b83d20",
      "name": "Get Project support1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6220,
        180
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get Tracked4').item.json.client }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"I hope you're doing well! 😊\\nIt looks like you're working on {{ $json.projectFound[0].name }}, and I wanted to check in with you to see if there's anything specific you need help with at the moment. Is there any issue or feature you'd like assistance on? Feel free to let me know, and I'll be happy to assist you in any way I can!\\nLooking forward to hearing from you!\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "b55316f9-4966-4225-b775-eb651c49c109",
      "name": "send message6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6440,
        180
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "project_list_id",
        "options": {}
      },
      "id": "1f79b060-e066-4bbb-a4ee-81cde31dc5e0",
      "name": "Split Out7",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        5600,
        180
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "project_list_id",
        "options": {}
      },
      "id": "dd01375a-0d6b-4e61-b786-fec9c023e316",
      "name": "Split Out8",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        4720,
        -200
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1419606979,
          "mode": "list",
          "cachedResultName": "Client Follow Cms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lM_TG2ExLdbs1YoBcaFzBFscVqB3MOEFjBFnvE9kAa0/edit#gid=1419606979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "89353306-5e34-4e04-bf9f-6870b40d58e1",
      "name": "Get Tracked4",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        3940,
        -80
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "P5h6CdXmV7twphIt",
          "name": "Canh Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Tracked4').item.json.list_id_project }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not_comfirm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bd6d7b3a-906e-4c37-8d1d-2297746652b3",
                    "leftValue": "={{ $('Get Tracked4').item.json.list_id_project }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirm"
            }
          ]
        },
        "options": {}
      },
      "id": "8fcd41fa-5916-4d53-8c6a-90c115fe03ae",
      "name": "Switch6",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        4160,
        -80
      ]
    },
    {
      "parameters": {},
      "id": "6947eb23-d758-4d24-acf0-446034d49751",
      "name": "No Operation, do nothing2",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        7160,
        -520
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8dd5f6e1-5663-4875-9a95-0ef4f4cc4b33",
              "name": "messagesSent",
              "value": "={{ $('Get All Messages9').item.json.messagesSent }}",
              "type": "string"
            },
            {
              "id": "32b12d76-b7d0-45e2-bb6e-79e2471d3d00",
              "name": "project.name",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].name }}",
              "type": "string"
            },
            {
              "id": "6256a5cf-e613-4a5e-97cd-2a7577d602d0",
              "name": "project.status",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].status }}",
              "type": "string"
            },
            {
              "id": "507895aa-b100-48f3-91f4-b73275d561ce",
              "name": "project.start_date",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].start_date }}",
              "type": "string"
            },
            {
              "id": "6188ba61-5d09-4981-9897-9c51baebf721",
              "name": "project.deadline",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].deadline }}",
              "type": "string"
            },
            {
              "id": "21d301e8-3923-48a7-8fb6-a3a7bb808464",
              "name": "project.members",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].members }}",
              "type": "array"
            },
            {
              "id": "b6b31ed5-06b9-4d6e-b123-3a3542340022",
              "name": "client",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].client }}",
              "type": "object"
            },
            {
              "id": "597832ff-562f-437a-b31b-aa1080688fc8",
              "name": "project.milestone",
              "value": "={{ $json.data }}",
              "type": "array"
            },
            {
              "id": "2e6ff1ea-6500-48f3-ae73-6cf8543209a0",
              "name": "project.id",
              "value": "={{ $('Get Project CMS By Client').item.json.data[0].id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "c94ed32d-f287-4341-b97e-8474788fb346",
      "name": "Edit Fields1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4800,
        -840
      ]
    },
    {
      "parameters": {
        "resource": "project",
        "operation": "getMilestones",
        "ID": "={{ $('Get Project CMS By Client').item.json.data[0].id }}",
        "additionalFields": {
          "limit": "50"
        },
        "requestOptions": {}
      },
      "id": "e148b137-74fe-4ced-ab08-a5905dad7358",
      "name": "Cloodo Milestone1",
      "type": "@cloodo/n8n-nodes-cloodo-crm.CloodoLeads",
      "typeVersion": 1,
      "position": [
        4600,
        -840
      ],
      "credentials": {
        "cloodoApi": {
          "id": "nP7U7wKTbfdSeafq",
          "name": "Cmsmart Worksuite account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "447a1898-ebee-4ca6-bcac-2a0bd06cb588",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        4760,
        -560
      ],
      "credentials": {
        "openAiApi": {
          "id": "wXCGwiut9MvtTGmk",
          "name": "Workflow API"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=8db38109-d083-45b4-8cb4-60f16cd5bbf9"
      },
      "id": "255c49e8-6b89-4982-8cbe-3d1ce34c4308",
      "name": "Window Buffer Memory1",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        4880,
        -500
      ]
    },
    {
      "parameters": {
        "name": "create_new_project",
        "description": "Call this tool to creat new project. The input should be are name of project and summary of project",
        "workflowId": {
          "__rl": true,
          "value": "ul59bchkMPmnFbMy",
          "mode": "list",
          "cachedResultName": "Messager - Create New Project"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "member_project",
              "stringValue": "={{ $('Get CLient CMS By Email1').item.json.data[0].added_by.id }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "315591e8-2a04-45e6-a486-aab748f711bf",
      "name": "create_new_project1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        5020,
        -420
      ]
    },
    {
      "parameters": {
        "name": "resolve_problem_ticket",
        "description": "Call this tool to resolve problem ticket when client want to support with their ticket. The input should be is number of ticket",
        "workflowId": {
          "__rl": true,
          "value": "vNXQba5R8WXZU80n",
          "mode": "list",
          "cachedResultName": "Messager - Resolve proplem of Ticket"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "07c3fd98-04d0-40ee-9660-c89177fbdfc9",
      "name": "resolve_problem_ticket1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        5340,
        -420
      ]
    },
    {
      "parameters": {
        "name": "ask_info_project",
        "description": "Call this tool to reply client when client ask about their project.\n",
        "workflowId": {
          "__rl": true,
          "value": "UO7emuUbJgzax4sw",
          "mode": "list",
          "cachedResultName": "Messager - Reply Info Project"
        },
        "fields": {
          "values": [
            {
              "name": "project_id",
              "stringValue": "={{ $json.project.id }}"
            },
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "8fb3258a-9fb9-4193-8ede-0ace053f8c4e",
      "name": "ask_info_project1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        5200,
        -400
      ]
    },
    {
      "parameters": {
        "name": "take_care_client",
        "description": "Call this tool to help customers with their requests such as adding new features, processing refunds, invoice, estimate or other tasks. The input data for the request is the issue they need support for.",
        "workflowId": {
          "__rl": true,
          "value": "69ieUP8Gx9VnyEbG",
          "mode": "list",
          "cachedResultName": "Messager - Take care Client"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "project_id",
              "stringValue": "={{ $('Edit Fields1').item.json.project.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "6d0c4821-c083-4aaf-9eb1-0e3e8b53a525",
      "name": "take_care_client1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        5480,
        -460
      ]
    },
    {
      "parameters": {
        "name": "summary_chat_session",
        "description": "Call this tool to perform a summary of the issues discussed with the customer during that session when the customer's issue requiring support has been resolved and the customer has no further requests. The request data is the customer's message confirming that their issue has been resolved and that there are no further requests.",
        "workflowId": {
          "__rl": true,
          "value": "1Os3kiRF9eclEf4j",
          "mode": "list",
          "cachedResultName": "Messager - Summary chat Session"
        },
        "fields": {
          "values": [
            {
              "name": "id",
              "stringValue": "={{ $('Switch Quantity Project2').item.json.id }}"
            },
            {
              "name": "messages",
              "stringValue": "={{ $json.messagesSent }}"
            },
            {
              "name": "client_id",
              "stringValue": "={{ $('Edit Fields1').item.json.client.id }}"
            },
            {
              "name": "conversation",
              "stringValue": "={{ $('HTTP Request5').item.json.data[0].id }}"
            }
          ]
        }
      },
      "id": "f1ac4e93-0de1-4c0d-afea-8c14beef9076",
      "name": "summary_chat_session1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        5620,
        -520
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Switch Quantity Project2').item.json.id }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.output.replaceAll(/\"/g, '') }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "0c5a257c-cf7a-4d3e-9691-91138ddbf81a",
      "name": "send message7",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6680,
        -860
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "51d163c9-5926-4169-a8a7-8a0cdeb98caa",
              "leftValue": "={{ $json.messages.data[0].from.id }}",
              "rightValue": "112710510078308",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d2493520-61e9-4c3d-9885-9340c8120f1f",
      "name": "Last send by Client2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        5860,
        -840
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $json.id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "messages{id,message,from,to}"
            },
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "8953cdd7-f549-44d2-b7a5-923c7fabf305",
      "name": "Get Detail list Chat User11",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5660,
        -840
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['AI Agent1']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "2c1b3049-b040-4fb8-bc31-99297a390b90",
      "name": "Code13",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6480,
        -860
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ALWAYS use plain text and simple bullet points if need for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.\n\nAct as LiveChat AI Assistant \n\nUse the data i provide dynamically below in a way that helps analyze the client's needs and deliver personalized responses, but without directly repeating the data back to the client. You must leverage the information you've supplied to inform its conversation flow and provide insightful, helpful responses based on the client's context.\n\nInformation about client project\nProject name: {{ $json.project.name }}\nProject status: {{ $json.project.status }}\nStart date: {{ $json.project.start_date }}\nDeadline: {{ $json.project.deadline }}\nProject members: {{ $json.project.members.map(item=> item.name) }}\n\nInformation about client:\nName: {{ $json.client.name }}\nEmail: {{ $json.client.email }}\nMobile: {{ $json.client.mobile }}\n\n\nHistory chat messages:\n{{ $json.messagesSent }}\n\n\nAI Assistant Prompt with Contextual Analysis:\nGreeting the Client:\n\n\"Hello! 👋 Welcome to [Company Name]. I’m [Your AI Assistant Name], and I’m here to assist you today. How can I help you?\"\n\n(If the client hasn’t initiated the conversation yet, this greeting will prompt them to describe their needs or project.)\n\n1. If the Client Wants to Create a New Project:\nLet call to create_new_project tools\n\n2. If the Client Needs Support with a Ticket:\nLet call to resolve_problem_ticket tools\n\n3. If the Client Asks About Their Project Information (Milestones, Status, Tasks):\nLet call to ask_info_project tools\n\n4. If the Client Wants to Add a New Feature:\nLet call to take_care_client tools\n\n5. If the Client Requests a Refund or invoice:\nLet call to take_care_client tools\n\n6. Handling Last Message from Client:\nBased on your most recent message, I can see that you’re asking about [issue or request]. Let’s address that right away!\n\nFor example, if the client’s last message is about needing help with a project feature or milestone, the AI would respond:\n\n\"I noticed you're asking about [Milestone X]. Let me help you with that! Could you confirm if you're looking for updates on this milestone or if you need assistance with a specific task related to it?\"\n\n8. Wrapping Up the Chat:\n\"Thank you for sharing all of this information with me! I’ll make sure everything is updated and will send you an email confirmation shortly.\n\nIs there anything else I can assist you with while we’re still chatting?\"\n\n9. Closing the Chat:\nLet call to summary_chat_session tools\n\n\nHow the AI Uses Your Data Dynamically:\nHistory Chat Messages:\n\nThe AI reviews the client’s past messages and uses them to tailor the conversation. For example, if the client mentioned a problem earlier, the AI might start by asking if the issue has been resolved or needs further assistance.\nClient Project Information:\n\nThe AI will dynamically access the project’s name, status, and milestones (e.g., “Your project [Project Name] is currently in [Current Status] and includes milestones like [Milestone 1, Milestone 2]”). This contextualizes the conversation, allowing the AI to give specific advice or updates based on the project’s current phase.\nClient’s Last Message:\n\nThe AI will analyze the last message from the client and build the conversation around it, ensuring that it stays relevant to their current needs (e.g., \"I see you're asking about [specific feature or issue], let me help you with that!\").\n\nFinal Notes:\nStart with a friendly greeting whenever a new conversation begins.\nAsk for relevant details based on what the client needs (creating a project, ticket support, project information, new features, or refunds).\nUse the project information you provide dynamically to craft responses, ensuring that you don’t repeat the data back verbatim but use it to inform the conversation.\n\nALWAYS use plain text with simple bullet points for clear and friendly communication. Do not apply any text effects, such as bold, italics, or headings. Keep the message simple, straightforward, and easy to read.",
        "options": {}
      },
      "id": "0e4ddaae-80be-4537-9730-93e4fdd526f6",
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        5060,
        -840
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "facebook",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        300,
        -1760
      ],
      "id": "39a170d6-3c0c-4dcf-9567-ec0809c3e79e"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4d2c20e6-0727-4f45-a578-0e63ea7d8ece",
              "leftValue": "={{ $json.messages.data[0].from.name }}",
              "rightValue": "Cmsmart Ecommerce",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "09746f2a-d77c-42c9-b617-b505eb851746",
      "name": "check cms send",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1440,
        -2140
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"{{ $json.inf.from.email }}\",\n      \"to\": \"{{ $json.inf.to.data[0].email }}\",\n      \"body\": \"{{ $json.output }}\",\n      \"fromMe\": false,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $json.inf.to.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "8f87d2d8-f39d-4bfd-82e1-0608ee0562fd",
      "name": "Post message lên workchat from client",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1900,
        -1980
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "let info = $input.all()[0].json.messages?.data[1]\nlet message =  $input.all()[0].json.messages?.data[1]?.message\nconsole.log('arg: ', message)\nmessage = message.replace(/\\*/g, '')\nmessage = message.replace(/\\n\\n/g, '\\\\n\\\\n');\nmessage = message.replace(/\\n/g, '\\\\n');\nmessage = message.replace(/\"/g, '');\nreturn {\n  inf: info,\n  output: message\n};"
      },
      "id": "9ef13a05-d445-4652-ab04-b41f253d4169",
      "name": "Code14",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1660,
        -1980
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"{{ $json.inf.from.email }}\",\n      \"to\": \"{{ $json.inf.to.data[0].email }}\",\n      \"body\": \"{{ $json.output }}\",\n      \"fromMe\": false,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $json.inf.from.name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "cfcd72b1-c267-4566-9c7c-6e5051a54b06",
      "name": "Post message lên workchat from client1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1900,
        -2260
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "let info = $input.all()[0].json.messages?.data[0]\nlet message =  $input.all()[0].json.messages?.data[0]?.message\nconsole.log('arg: ', message)\nmessage = message.replace(/\\*/g, '')\nmessage = message.replace(/\\n\\n/g, '\\\\n\\\\n');\nmessage = message.replace(/\\n/g, '\\\\n');\nmessage = message.replace(/\"/g, '');\nreturn {\n  inf: info,\n  output: message\n};"
      },
      "id": "1a1b8595-3f88-4903-aa96-0f91ccf583db",
      "name": "Code15",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1660,
        -2260
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "750bc411-775b-45e9-a81b-753619f0a3d4",
      "name": "MySQL Get Detail Messages",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        3540,
        -1380
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "dc9ba00d-931b-4c55-b08a-970a42cd4192",
      "name": "MySQL Get Info Client",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        3360,
        -1380
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "4ce51908-ff22-49ab-818a-01dfb42c1bd6",
      "name": "Aggregate13",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3740,
        -1380
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate13']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "daa29dd6-986a-41d9-b28c-82d856a00fcf",
      "name": "Get All Messages7",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3920,
        -1380
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client2').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client2').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client2').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client2').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "cb26434b-06b1-4fe0-8851-41d85955e6f8",
      "name": "MySQL Get Detail Messages2",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        2700,
        -2220
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "9320bfe2-c521-450f-b887-a4a8644c616b",
      "name": "MySQL Get Info Client2",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        2520,
        -2220
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "8931f19f-2b39-43e2-9a3b-230aed6c42e1",
      "name": "Aggregate14",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2920,
        -2220
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate14']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "8d305b3b-130d-4380-88b7-7760e86f1e3a",
      "name": "Get All Messages8",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3120,
        -2220
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a customer request analyst. The customer makes a request in the message below, analyzes and concludes \"problem\" or \"email\" based on the content that the customer mentions needing support.\n\nIf in the conversation, the customer only states the problem and does not explain further or the customer explains, then the conclusion is \"problem\"\nIf in the conversation, in the most recent message, the customer sends information including email, then the conclusion is \"email\". For example, if in the conversation, the customer talks about the problem of anything that does not have email in it, then the conclusion is \"problem\"; If in the conversation, the customer talks about information including email, then the conclusion is \"email\".\n\nJust conclude \"problem\" or \"email\" without further explanation.\nHere is the message information you need to analyze to draw conclusions:\n{{ $json.messagesSent }}\n",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "3ecb662f-fb67-458a-bf2f-74d71660b818",
      "name": "OpenAI4",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        3300,
        -2220
      ],
      "credentials": {
        "openAiApi": {
          "id": "wXCGwiut9MvtTGmk",
          "name": "Workflow API"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "problem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "18ae536c-a09d-463d-88e1-ab7a1f22013e",
                    "leftValue": "={{ $json.message.content.toLowerCase()}}",
                    "rightValue": "email",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "email"
            }
          ]
        },
        "options": {}
      },
      "id": "75345625-9f0a-433b-b17b-971112aa34de",
      "name": "Switch3",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3680,
        -2220
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.id = {{ $('Aggregate14').item.json.data[0].user_one ? `\"${$('Aggregate14').item.json.data[0].user_one}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "06b141d5-fc9d-4cad-9cf4-5b319cbf927e",
      "name": "MySQL Get Info Client3",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        4580,
        -2540
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_AVeiW0a2XaMvsu5SwqARpYN6",
          "mode": "list",
          "cachedResultName": "Cmsmart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=You are a customer request analyst and an administrator named Cmsmart Ecommerce is talking to a customer in a friendly manner. The customer has given a request in the message below and you do not have the customer's email, analyze it according to the following requirements:\n- Analyze the customer's problem\n- Restate the customer's problem\n- Ask the customer to provide additional missing information\n- Most importantly, get the customer's email\nThen send a friendly message starting with Hello and ending with Best Regard, Printcart\nHere is the message information you need to analyze to send a message to the customer:\n{{ $('Get All Messages8').item.json.messagesSent }}",
        "options": {}
      },
      "id": "2cea80e6-fa32-41b3-8183-55882fdab024",
      "name": "OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        4000,
        -2540
      ],
      "credentials": {
        "openAiApi": {
          "id": "NuSZIBmfyaC1efAa",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('MySQL Get Info Client3').item.json.email }}\",\n      \"body\": \"{{ $('Code8').item.json.output.replaceAll(/\"/g, '') }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('MySQL Get Info Client3').item.json.name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "529f605a-a4b1-41fe-809a-e85e080225ab",
      "name": "Post message lên workchat from admin",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5120,
        -2540
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "4dbec356-5b9b-4370-975d-4f0e2cac69eb",
      "name": "Get User Facebook",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4460,
        -2240
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "1cb4d520-2b42-4c91-8533-4689f327bbf3",
      "name": "Get User Facebook1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4480,
        -1920
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not client"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fea13891-5065-4d09-807e-5ce6aabc432a",
                    "leftValue": "={{ $json.data.length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "is client"
            }
          ]
        },
        "options": {}
      },
      "id": "4c135a4f-bad8-4715-b2c6-c1dea6539fa1",
      "name": "Switch4",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        4920,
        -2240
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook1').item.json.participants.data[0].email }}\",\n      \"body\": \"Dear {{ $json.participants.data[0].name }},\\nI’m reaching out regarding the email address you provided. Unfortunately, it appears that the email is incomplete or missing. Could you kindly provide the correct email address at your earliest convenience? This will help us proceed with your request smoothly.\\n Thank you for your understanding and cooperation. Please let me know if you need any assistance with this.\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook1').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "dfd1b30e-68f1-44f3-9929-e19ab56b752b",
      "name": "Post message lên workchat from admin1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5480,
        -1900
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n      \"body\": \"Hello {{ $('Get User Facebook').item.json.participants.data[0].name }}, \\nTo provide you with the best support possible, we've created a new client account for you on our system. Please login using the email we've registered for you. For security reasons, we recommend setting a new password upon your first login. You can do this by visiting our website and following the instructions for 'Forgot Password' if needed.\\nUsername: {{ $('Take mail1').item.json.Email }} \\nPassword: qK8|*E04J}06 \\nVisit our system: https://worksuite.cloodo.com/ \\nIf you have any questions during the process, feel free to reach out for assistance.\\nThank you for working with us!\\nLet me know if there's anything else you need or if there's any other way I can assist you!\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "e502e878-e3cc-4fbe-91dd-c755c301a0ae",
      "name": "Post message lên workchat from admin2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6120,
        -2320
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook').item.json.participants.data[0].email }}\",\n      \"body\": \"Thank you for providing the details. We’ve successfully received the information you’ve provided, and everything seems to be in order.\\nIn order to assist you further, could you kindly clarify the issue you are encountering? Please provide as much detail as possible so we can resolve it efficiently.\\nWe’re here to help, and we look forward to your response.\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "3e35b017-131b-42c1-a52c-bf4df755ffb7",
      "name": "Post message lên workchat from admin3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5840,
        -2120
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "e4ada8f7-2037-466e-b800-2c27040cf424",
      "name": "Get User Facebook2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4480,
        -1380
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"Hi {{ $('Get User Facebook2').item.json.participants.data[0].name }}, thank you for reaching out. I’m here to assist you with your project needs. Could you share a bit more about what you’re looking for assistance with?\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "a2123906-877a-4cba-bac1-f33a3f4b94fe",
      "name": "Post message lên workchat from admin4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5520,
        -1380
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"{{ $('Code9').item.json.output.replaceAll(/\"/g, '') }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "539d252b-040b-41cb-a23f-2b10490c9874",
      "name": "Post message lên workchat from admin5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5760,
        -1160
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('OpenAI3').item.json.message.content.toLowerCase()}}",
                    "rightValue": "problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "problem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "587ec149-5360-42e4-975c-a4f1210d55f7",
                    "leftValue": "={{ $('OpenAI3').item.json.message.content.toLowerCase()}}",
                    "rightValue": "welcome",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "welcome"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9dcadeba-3b70-4df1-bd15-804112cfaf26",
                    "leftValue": "={{ $('OpenAI3').item.json.message.content.toLowerCase()}}",
                    "rightValue": "unclear problem",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "unclear problem"
            }
          ]
        },
        "options": {}
      },
      "id": "34fe3333-c08a-42ec-9fb7-89aab911c94e",
      "name": "Switch5",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        4680,
        -1380
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list",
          "cachedResultName": "GPT-4"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a customer request analyst. The customer makes a request in the message below, analyzes and concludes \"welcome\" or \"problem\" or \"unclear problem\" based on the problems the customer mentions needing support. If in the chat, the customer only states the problem and does not explain further, then the conclusion is \"unclear problem\". If in the chat, the customer only sends a greeting, then the conclusion is \"welcome\", but if the customer states the problem and explains the problem, then the conclusion is \"problem\". For example, if in the chat, the customer says: \"Hi, I just had a problem setting up the website... after installing and trying to edit or do anything, I keep getting a 503 error\" then the conclusion is \"problem\" because the customer explains that \"after installing and trying to edit or do anything, I keep getting a 503 error\"; If in the chat the customer says \"Hello, I want a refund\" then the conclusion is \"welcome\"; If in the chat the customer talks about an unclear issue then the conclusion is \"unclear problem\"\n\nJust return \"problem\" or \"welcome\" or \"unclear problem\" without explaining and adding any words.\nHere is the message information you need to analyze to come to a conclusion:\n{{ $json.messagesSent }}\n",
              "role": "assistant"
            }
          ]
        },
        "options": {}
      },
      "id": "a888be91-5aed-4e4e-b7fe-ac59d692ecd8",
      "name": "OpenAI3",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        4120,
        -1380
      ],
      "credentials": {
        "openAiApi": {
          "id": "wXCGwiut9MvtTGmk",
          "name": "Workflow API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let messagerAI = $node['OpenAI5']?.json?.output\n  messagerAI = messagerAI.replace(/\\n\\n/g, '\\\\n\\\\n');\n  messagerAI = messagerAI.replace(/\\n/g, '\\\\n');\n  messagerAI = messagerAI.replace(/###/g, '');\n  messagerAI = messagerAI.replace(/\\**/g, '');\n  item.json.output = messagerAI;\n}\n\nreturn $input.all();"
      },
      "id": "91e961a0-62b6-4702-87ca-c0332c498b77",
      "name": "Get Info Issue",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5260,
        -1620
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v21.0/213439902114044/messages",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Get User Facebook2').item.json.participants.data[0].id }}\"\n  },\n  \"messaging_type\": \"MESSAGE_TAG\",\n  \"tag\": \"ACCOUNT_UPDATE\",\n  \"message\": {\n    \"text\": \"{{ $json.output }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "f8f9f78e-10c1-48ba-ba04-e548dc6e02c6",
      "name": "send welcome3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5500,
        -1620
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook2').item.json.participants.data[0].email }}\",\n      \"body\": \"{{ $('Get Info Issue').item.json.message }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook2').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "309b34ff-30b8-43a5-a69e-97ad37d8398e",
      "name": "Post message lên workchat from admin6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5800,
        -1620
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=Analyze the following chat messages between the customer and the administrator. Focus on the most recent messages sent by the customer, especially the last message, to determine the customer's intent. And with the data you have, provide information to the customer in the most effective way.\n\nHere are the chat messages in history:\n\n1. Customer Request:\n\nList the messages sent by the customer to the administrator:\n\nCustomer sent: I need support\nTime sent: 2025-02-10 17:46:50\n\nAdmin sent: Hello,\n\nThank you for contacting Cmsmart Ecommerce. I understand that you are looking for support and I am here to assist you.\n\nCan you please provide more details about the specific support you need? For example, are you having difficulty with a specific product, service, or technical issue? Any additional information will help ensure we address your concern effectively.\n\nAlso, may I request your email address to keep your records accurate and ensure follow-up communications are sent to you in a timely manner?\n\nBest regards,\nPrintcart\nTime Sent: 2025-02-10 18:08:32\n\nCustomer Sent: thanhtung2432004@gmail.com\nTime Sent: 2025-02-10 18:11:57\n\nAdmin Sent: Thank you for your detailed information. We have received your information successfully and everything seems to be fine.\n\nTo assist you further, could you please clarify the issue you are experiencing? Please provide as much detail as possible so we can address this issue effectively.\n\nWe are here to help and we look forward to hearing from you.\nTime sent: 2025-02-11 10:12:26\n\nCustomer sent: I need information about Cmsmart Ecommerce\nTime sent: 2025-02-12 09:55:04\n\nCustomer sent: I need information about Cmsmart Ecommerce\nTime sent: 2025-02-12 10:03:47\n\nCustomer sent: I need information about Cmsmart Ecommerce\nTime sent: 2025-02-12 10:36:31\n\nCustomer sent: I need information about Cmsmart Ecommerce\nTime sent: 2025-02-12 11:32:51\n\nCustomer sent: I need information about Cmsmart Ecommerce\nTime sent: 2025-02-12 11:36:37\n\nAdministrator value is: Hello,\n\nThank you for contacting Cmsmart Ecommerce. It appears that you are looking for information about our company. In order to better assist you, please indicate what type of information you are looking for? Are you looking for information about our products, services, company history, or perhaps something else?\n\nAny additional details you can provide will help us provide you with the most accurate and helpful information.\n\nLooking forward to hearing from you!\n\nBest regards,\nCmsmart Ecommerce Team\nSubmission Time: 2025-02-12 11:36:55\n\nCustomer Submitted: I Want to Download Cmsmart Designer Plugin\nSubmission Time: 2025-02-12 11:42:25\n\nCustomer Submitted: I Want to Download Cmsmart Designer Plugin\nSubmission Time: 2025-02-12 11:42:43\n\nAdministrator Submitted: Dear Nguyen Thanh Tung,<br><br>We confirm your request to download the Cmsmart Designer plugin. Please visit the official Cmsmart website to find the download link and follow the installation instructions provided. If you need further assistance with this process, do not hesitate to contact us.<br><br>Best regards,<br>Cmsmart Admin\nTime sent: 2025-02-12 14:17:24\n\nCustomer sent: Cmsmart design plugin price\nTime sent: 2025-02-12 14:25:16\n\nWith the above data, only take the last information to analyze based on Cmsmart data\n\nConvert to message format with Customer name as canh and Best Regard as Admin Cmsmart",
        "options": {}
      },
      "id": "ea443784-e9d9-4cd9-9ff4-b51e654959f8",
      "name": "OpenAI8",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        3140,
        -3360
      ],
      "credentials": {
        "openAiApi": {
          "id": "wXCGwiut9MvtTGmk",
          "name": "Workflow API"
        }
      }
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_AVeiW0a2XaMvsu5SwqARpYN6",
          "mode": "list",
          "cachedResultName": "Cmsmart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=You are a customer request analyst and an administrator named Cmsmart Ecommerce is talking to a customer in a friendly manner. The customer has given a request in the message below and the problem is not clear, analyze it according to the following requirements:\n- Analyze the customer's problem\n- Restate the customer's problem\n- Ask the customer to provide more missing information\nThen combine the above ideas and reply to the customer with a short message combining the above ideas in a friendly manner.\nHere is the message information you need to analyze to send a message to the customer:\n{{ $('Get All Messages7').item.json.messagesSent }}",
        "options": {}
      },
      "id": "8de4874e-db3e-49e0-bfe1-987a1b7d7a12",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        4820,
        -1160
      ],
      "credentials": {
        "openAiApi": {
          "id": "NuSZIBmfyaC1efAa",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_zcZjKKD7msrnRvUMoHUoWzhV",
          "mode": "list",
          "cachedResultName": "Cmsmart AI"
        },
        "prompt": "define",
        "text": "=You are an assistant of Cmsmart and you have been provided with most of the products as well as the prices of each item of each product of Cmsmart. Your job is in the following chat messages between customers and administrators. Focus on the most recent messages sent by customers, especially the last message, to determine the customer's intention. And with the data you have, provide information to customers in the most effective way.\n\nHere are the chat messages in history:\n\n{{ $('Get All Messages7').item.json.messagesSent }}\n\nWith the above data, only get the last information, see that information based on Cmsmart data\nThere is no general response to get the data about Cmsmart that you are provided\n\nSwitch to message format with Customer Name is canh and Sincerely Cmsmart Administrator\n\nReturn only starting from Dear and ending with Best Regard",
        "options": {}
      },
      "id": "c2173e1b-40bc-47ff-96d9-18b25f8eafdf",
      "name": "OpenAI5",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        4840,
        -1620
      ],
      "credentials": {
        "openAiApi": {
          "id": "wXCGwiut9MvtTGmk",
          "name": "Workflow API"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client4').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client4').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client4').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client4').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "97d21ec7-c707-45e1-a443-3371dc88262c",
      "name": "MySQL Get Detail Messages3",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        4000,
        -840
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "977dd7b2-be17-49f2-b531-0e10ec16e613",
      "name": "MySQL Get Info Client4",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        3780,
        -840
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "5fb6ba8e-6edb-4ff4-af9b-88c1bc4d64f5",
      "name": "Aggregate15",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4220,
        -840
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate15']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "5b64fdb7-6839-4df9-97ba-66eab8a28ac0",
      "name": "Get All Messages9",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4400,
        -840
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants,messages{id}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "9e618865-1697-474d-a6f8-887225be371f",
      "name": "Get User Facebook3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5440,
        -840
      ]
    },
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_AVeiW0a2XaMvsu5SwqARpYN6",
          "mode": "list",
          "cachedResultName": "Cmsmart Admin - AI Assistant"
        },
        "prompt": "define",
        "text": "=ALWAYS use plain text and simple bullet points if clear and friendly communication is required. Do not apply any text effects such as bold, italics or headings. Keep the message simple, easy to understand and read.\n\nAct as a LiveChat AI Assistant\n\nUse the data I provide below dynamically in a way that helps analyze the customer's needs and provide personalized responses, but do not directly repeat the data to the customer. You must leverage the information you have provided to inform the conversation flow and provide useful, insightful responses based on the customer's context.\n\nClient Project Information\nProject Name: {{ $('Edit Fields1').item.json.project.name }}\nProject Status: {{ $('Edit Fields1').item.json.project.status }}\nStart Date: {{ $('Edit Fields1').item.json.project.start_date }}\nDeadline: {{ $('Edit Fields1').item.json.project.deadline }}\nProject Members: {{ $('Edit Fields1').item.json.project.members.map(item=> item.name) }}\n\nClient Information:\nName: {{ $('Edit Fields1').item.json.client.name }}\nEmail: {{ $('Edit Fields1').item.json.client.email }}\nMobile: {{ $('Edit Fields1').item.json.client.mobile }}\n\nHistorical chat messages:\n{{ $('Edit Fields1').item.json.messagesSent }}\n\nRespond to the customer's question. Focus on the last message the customer sent to give the best answer to the customer\n\nFinal notes:\nStart with a friendly greeting whenever a new conversation begins.\nAsk for relevant details based on the customer's needs (project creation, support ticket, project information, new features, or refund).\nUse the project information you provide dynamically to create a response, making sure you don't repeat the data verbatim but use it to inform the conversation.\n\nALWAYS use plain text with simple bullet points to communicate clearly and friendly. Do not apply any text effects, such as bold, italics, or titles. Keep the message simple, clear, and easy to read.\nAvoid phrases that suggest you are an AI Assistant",
        "options": {}
      },
      "id": "2b5e5c0d-4253-47ef-b701-7553836beecf",
      "name": "OpenAI7",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        6080,
        -860
      ],
      "credentials": {
        "openAiApi": {
          "id": "NuSZIBmfyaC1efAa",
          "name": "AI_Agent_API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook3').item.json.participants.data[0].email }}\",\n      \"body\": \"{{ $('Code13').item.json.output.replaceAll(/\"/g, '') }}\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook3').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "bf186d78-0ccc-4787-9606-a6fd4788e110",
      "name": "Post message lên workchat from admin7",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6880,
        -860
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *, (\n  SELECT COUNT(*) FROM user_chats WHERE (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client5').item.json.id }}) OR  (user_chats.from = {{ $('MySQL Get Info Client5').item.json.id }} AND user_chats.to = 62844)\n) AS Total_Messages\nFROM user_chats\nWHERE \n  (user_chats.from = 62844 AND user_chats.to = {{ $('MySQL Get Info Client5').item.json.id }}) \n  OR \n  (user_chats.from = {{ $('MySQL Get Info Client5').item.json.id }} AND user_chats.to = 62844) ORDER BY user_chats.created_at DESC;\n",
        "options": {}
      },
      "id": "4068fb48-5c81-4867-a0de-dabca857b641",
      "name": "MySQL Get Detail Messages4",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        4740,
        180
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM users WHERE users.email = {{ $('Last send by client').item.json.from.email ? `\"${$('Last send by client').item.json.from.email}\"` : '\" \"' }}\n",
        "options": {}
      },
      "id": "7bc4fc9e-8a37-4378-b92a-7c988a75c060",
      "name": "MySQL Get Info Client5",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        4480,
        180
      ],
      "credentials": {
        "mySql": {
          "id": "SJei6ksLjiCIXFRS",
          "name": "Worksuite database"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "92bf1d80-a019-41af-a62e-eadffccf3481",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4980,
        180
      ]
    },
    {
      "parameters": {
        "jsCode": "const listMessages = $node['Aggregate']?.json?.data\nlet document =''\ndocument+='List Messages sent by client with admin: \\n'\nfor (const item of listMessages.reverse()) {\n  document+= `${item?.user_one == 62844 ? 'Admin send: ' : 'Client sent: '} ${item?.message} \\nTime Send: ${item?.created_at} \\n\\n`\n}\n\n// document+=`\\n\\n Last message sent by client: ${listMessages[listMessages.length-1].message}`\nconsole.log(document)\nreturn {messagesSent: document};"
      },
      "id": "f062b64b-799e-467a-bd63-c6ea82d2d869",
      "name": "Get All Messages",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5180,
        180
      ]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants,messages{id}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "23e601b0-186b-4cf0-b581-3a8a19e2475d",
      "name": "Get User Facebook4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4440,
        500
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook4').item.json.participants.data[0].email }}\",\n      \"body\": \"Hi {{ $('Get CLient CMS By Email1').item.json.data[0].user.name }},\\nIt seems that you currently don’t have any active projects in our system. To ensure we can assist you effectively and keep everything well-organized, we’ve gone ahead and created a project for you.\\nYou can access the project here: https://worksuite.cloodo.com/apps/work/project/{{ $('Create Project2').item.json.data.id }}/\\nFeel free to check it out and let us know if there’s anything specific you’d like to add. We’re here to help with whatever you need!\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook4').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "944b636f-3207-4d03-a7ae-8b375093ca06",
      "name": "Post message lên workchat from admin8",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4640,
        500
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v21.0/{{ $('HTTP Request5').item.json.data[0].id }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAA3ZCtCZCe57kBOzXf4fqSrVflYWE5Fk2P0BNfjOerautjGD8cKV0pZAnvdV3zRQwokzJiKmPUZBRWFn8Tmeq2rPD4zCHvZAZCRZCg9943vq93AmFKnbtrFd7bfZBiGBmOgiYYKD7qipJyirD8a3KxZC2GgLXxok3Dj2ZBObBCyBqHoLywAZAdC7mpmnbcTOYKZCZB6wZD"
            },
            {
              "name": "fields",
              "value": "participants,messages{id}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "9bb06f0b-f873-44d3-a21b-ee2ba95d9330",
      "name": "Get User Facebook5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6880,
        180
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://convert.cloodo.com/push-message-waba",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"only_info_company\": \"1\",\n    \"id\": \"411\",\n    \"data\": {\n      \"from\": \"213439902114044@facebook.com\",\n      \"to\": \"{{ $('Get User Facebook5').item.json.participants.data[0].email }}\",\n      \"body\": \"I hope you're doing well! 😊\\nIt looks like you're working on {{ $('Get Project support1').item.json.projectFound[0].name }}, and I wanted to check in with you to see if there's anything specific you need help with at the moment. Is there any issue or feature you'd like assistance on? Feel free to let me know, and I'll be happy to assist you in any way I can!\\nLooking forward to hearing from you!\",\n      \"fromMe\": true,\n      \"type\": \"chat\",\n      \"nameContact\": \"{{ $('Get User Facebook5').item.json.participants.data[0].name }}\"\n    }\n  },\n  \"act\": \"syncWabaChat\"\n}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "af6e3d5a-2370-45ac-8280-f71d2e2b440e",
      "name": "Post message lên workchat from admin9",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        7080,
        180
      ],
      "onError": "continueErrorOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "Get Detail Last list Chat User": {
      "main": [
        [
          {
            "node": "Last send by client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last send by client": {
      "main": [
        [
          {
            "node": "Get Tracked2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User6": {
      "main": [
        [
          {
            "node": "Get Detail Last list Chat User",
            "type": "main",
            "index": 0
          },
          {
            "node": "check cms send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked2": {
      "main": [
        [
          {
            "node": "Check mail2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Execute Workflow Trigger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code8": {
      "main": [
        [
          {
            "node": "MySQL Get Info Client3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome2": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "remind mail": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get CLient CMS By Email": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cloodo CRM Create New Client": {
      "main": [
        [
          {
            "node": "Create Project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Project1": {
      "main": [
        [
          {
            "node": "Update contact client2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send create account": {
      "main": [
        [
          {
            "node": "Append1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client2": {
      "main": [
        [
          {
            "node": "send create account",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update contact client3": {
      "main": [
        [
          {
            "node": "send received email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send received email": {
      "main": [
        [
          {
            "node": "Append3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append1": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append3": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Take mail1": {
      "main": [
        [
          {
            "node": "mail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mail1": {
      "main": [
        [
          {
            "node": "Get User Facebook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get User Facebook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check mail2": {
      "main": [
        [
          {
            "node": "MySQL Get Info Client2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get CLient CMS By Email1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Project CMS By Client": {
      "main": [
        [
          {
            "node": "Get Tracked3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Client Not Tracked Before": {
      "main": [
        [
          {
            "node": "Switch Quantity Project2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get CLient CMS By Email1": {
      "main": [
        [
          {
            "node": "Get Project CMS By Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked3": {
      "main": [
        [
          {
            "node": "Check Client Not Tracked Before",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome": {
      "main": [
        [
          {
            "node": "UP Level 1 - open1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 1 - open1": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome1": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code9": {
      "main": [
        [
          {
            "node": "send welcome1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Project2": {
      "main": [
        [
          {
            "node": "Create Task Take Care1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Task Take Care1": {
      "main": [
        [
          {
            "node": "Require Project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Require Project": {
      "main": [
        [
          {
            "node": "UP Level  2 create project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get list project": {
      "main": [
        [
          {
            "node": "OpenAI6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code get list pro": {
      "main": [
        [
          {
            "node": "Split Out7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code get list pro1": {
      "main": [
        [
          {
            "node": "Split Out8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 3 - ask_project2": {
      "main": [
        [
          {
            "node": "Get Tracked4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Quantity Project2": {
      "main": [
        [
          {
            "node": "MySQL Get Info Client4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "UP Level 3 - ask_project2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Project2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI6": {
      "main": [
        [
          {
            "node": "Get Project support1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level 3 - confirm_project": {
      "main": [
        [
          {
            "node": "Get User Facebook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Project support1": {
      "main": [
        [
          {
            "node": "send message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send message6": {
      "main": [
        [
          {
            "node": "UP Level 3 - confirm_project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out7": {
      "main": [
        [
          {
            "node": "Get list project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out8": {
      "main": [
        [
          {
            "node": "Get list project1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tracked4": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch6": {
      "main": [
        [
          {
            "node": "Code get list pro1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MySQL Get Info Client5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cloodo Milestone1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "create_new_project1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "resolve_problem_ticket1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ask_info_project1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "take_care_client1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "summary_chat_session1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "send message7": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Last send by Client2": {
      "main": [
        [
          {
            "node": "OpenAI7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Detail list Chat User11": {
      "main": [
        [
          {
            "node": "Last send by Client2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code13": {
      "main": [
        [
          {
            "node": "send message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Function",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code14": {
      "main": [
        [
          {
            "node": "Post message lên workchat from client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check cms send": {
      "main": [
        [
          {
            "node": "Code15",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code15": {
      "main": [
        [
          {
            "node": "Post message lên workchat from client1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate13": {
      "main": [
        [
          {
            "node": "Get All Messages7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages": {
      "main": [
        [
          {
            "node": "Aggregate13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages7": {
      "main": [
        [
          {
            "node": "OpenAI3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages2": {
      "main": [
        [
          {
            "node": "Aggregate14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client2": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate14": {
      "main": [
        [
          {
            "node": "Get All Messages8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages8": {
      "main": [
        [
          {
            "node": "OpenAI4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI4": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Take mail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client3": {
      "main": [
        [
          {
            "node": "send welcome2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "Code8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook": {
      "main": [
        [
          {
            "node": "Get CLient CMS By Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook1": {
      "main": [
        [
          {
            "node": "remind mail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Cloodo CRM Create New Client",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update contact client3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin2": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook2": {
      "main": [
        [
          {
            "node": "Switch5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin4": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin5": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch5": {
      "main": [
        [
          {
            "node": "OpenAI5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "send welcome",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI3": {
      "main": [
        [
          {
            "node": "Get User Facebook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send welcome3": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin6": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Code9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Info Issue": {
      "main": [
        [
          {
            "node": "send welcome3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI5": {
      "main": [
        [
          {
            "node": "Get Info Issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages3": {
      "main": [
        [
          {
            "node": "Aggregate15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client4": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate15": {
      "main": [
        [
          {
            "node": "Get All Messages9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages9": {
      "main": [
        [
          {
            "node": "Cloodo Milestone1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook3": {
      "main": [
        [
          {
            "node": "Get Detail list Chat User11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI7": {
      "main": [
        [
          {
            "node": "Code13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post message lên workchat from admin7": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Get User Facebook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Detail Messages4": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MySQL Get Info Client5": {
      "main": [
        [
          {
            "node": "MySQL Get Detail Messages4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Get All Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Messages": {
      "main": [
        [
          {
            "node": "Code get list pro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UP Level  2 create project1": {
      "main": [
        [
          {
            "node": "Get User Facebook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook4": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Facebook5": {
      "main": [
        [
          {
            "node": "Post message lên workchat from admin9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "fd805305-ef31-437f-82f7-2b075c523eb5",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3909475c03ca6926b6e6edc6a6f06c1feb448ce7ac700d69b17002085d9011f8"
  },
  "id": "SJ2Az23OeQTAADDE",
  "tags": []
}